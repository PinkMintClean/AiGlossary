<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate AI Character Glossary | Final Master Build</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Custom Scrollbar for sleek look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 4px; }
        ::-webkit-scrollbar-track { background: #f3f4f6; }
        .dark ::-webkit-scrollbar-thumb { background-color: #4b5563; }
        .dark ::-webkit-scrollbar-track { background: #1f2937; }

        /* Floating Index Styling */
        .floating-index {
            position: fixed;
            top: 100px;
            left: 5%;
            width: 250px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            z-index: 10;
        }

        /* Keyword Button Styling */
        .keyword-button {
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transform: scale(1);
        }
        .keyword-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .selected {
            background-color: #1e40af; /* Blue-800 */
            color: white;
            border-color: #1e3a8a;
        }

        /* Tooltip Styling */
        .tooltip-container {
            position: relative;
        }
        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 50;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Dark Mode Overrides */
        .dark body {
            background-color: #111827;
            color: #f3f4f6;
        }
        .dark .bg-white { background-color: #1f2937 !important; }
        .dark .text-gray-800 { color: #f3f4f6 !important; }
        .dark .text-gray-600 { color: #d1d5db !important; }
        .dark .bg-gray-100 { background-color: #374151 !important; }
        .dark .border-gray-300 { border-color: #4b5563 !important; }
        .dark .category-card { background-color: #1f2937 !important; }
        
        /* SVG Custom Styling */
        .body-path {
            fill: #60a5fa; /* Blue-400 */
            transition: fill 0.2s, transform 0.2s;
            cursor: pointer;
        }
        .body-path:hover {
            fill: #ef4444; /* Red-500 */
            transform: scale(1.02);
            filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.5));
        }
        .dark .body-path {
            fill: #3b82f6; /* Blue-500 in dark mode */
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-title[aria-expanded="true"] + .collapsible-content {
            max-height: 500px;
            transition: max-height 0.3s ease-in;
        }


    </style>
</head>
<body class="bg-gray-50 transition-colors duration-500">

    <div id="floating-index" class="floating-index hidden lg:block bg-white dark:bg-gray-800 p-4 rounded-xl shadow-xl space-y-2 border border-gray-200 dark:border-gray-700" role="navigation" aria-label="Glossary Navigation Index">
        <h3 class="text-xl font-bold mb-3 border-b pb-2 text-gray-800 dark:text-gray-200">Glossary Index</h3>
        <button id="darkModeToggle" class="w-full py-2 px-3 text-sm rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" aria-label="Toggle Dark and Light Mode" tabindex="0">
            Toggle Dark Mode
        </button>
        </div>

    <div class="max-w-7xl mx-auto p-4 lg:pl-80">
        <header class="text-center py-8 mb-8 bg-blue-700 rounded-xl shadow-2xl text-white">
            <h1 class="text-4xl font-extrabold tracking-tight">Ultimate AI Character Glossary</h1>
            <p class="mt-2 text-blue-200">Head-to-Toe Character Building & Smart Prompting</p>
        </header>

        <section class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg" aria-labelledby="prompt-builder-heading">
            <h2 id="prompt-builder-heading" class="text-3xl font-bold mb-4 text-gray-800 dark:text-gray-200">Your Custom Prompt (Real-Time Builder)</h2>
            <textarea id="prompt-output" rows="4" class="w-full p-4 mb-4 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 resize-none" placeholder="Select keywords below to build your prompt, or type custom ones..." aria-live="polite" aria-atomic="true"></textarea>
            
            <div class="flex justify-between items-center text-sm font-medium text-gray-600 dark:text-gray-400 mb-4">
                <span id="char-counter">Characters: 0</span>
                <span id="token-estimator">Estimated Tokens: 0</span>
            </div>

            <div class="flex flex-wrap gap-4">
                <button id="copy-button" class="flex-1 min-w-[150px] py-3 px-6 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-colors" aria-label="Copy Generated Prompt to Clipboard" tabindex="0">
                    Copy Prompt
                </button>
                <button id="clear-button" class="flex-1 min-w-[150px] py-3 px-6 rounded-lg font-semibold bg-red-500 text-white hover:bg-red-600 transition-colors" aria-label="Clear All Selected Keywords and Ratios" tabindex="0">
                    Clear Prompt
                </button>
            </div>
        </section>

        <section class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-2 text-gray-800 dark:text-gray-200">Synonym Translator Box (Smart Search)</h2>
            <input type="text" id="keyword-search" class="w-full p-4 border border-gray-300 rounded-lg text-lg focus:ring-yellow-500 focus:border-yellow-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Search a flagged word to find safe alternatives (Fuzzy Matching enabled)..." aria-label="Keyword Search and Synonym Finder"/>
        </section>
        
        <section class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-3 text-gray-800 dark:text-gray-200">Filter & Sort Options</h2>
            <div class="flex flex-wrap gap-4">
                <div class="flex-1 min-w-[200px]">
                    <label for="sort-dropdown" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sort By:</label>
                    <select id="sort-dropdown" onchange="sortGlossary(this.value)" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100" aria-label="Sort options for glossary">
                        <option value="order">Anatomical Flow (Default)</option>
                        <option value="alpha">Alphabetical (A-Z)</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[200px]">
                    <button id="random-button" class="w-full py-3 px-6 rounded-lg font-semibold bg-indigo-500 text-white hover:bg-indigo-600 transition-colors mt-6" aria-label="Generate a Random Character Prompt">
                        Random Character Generator
                    </button>
                </div>
            </div>
        </section>
        
        <section class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg" aria-labelledby="learning-heading">
            <h2 id="learning-heading" class="text-3xl font-bold mb-4 text-gray-800 dark:text-gray-200 border-b pb-2">Learning & Engagement Zone</h2>
            
            <div class="mb-6 border-b pb-4">
                <button onclick="toggleCollapsible('example-content', this)" class="collapsible-title w-full text-left py-2 px-4 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 font-semibold text-xl transition-colors hover:bg-blue-200 dark:hover:bg-blue-800" aria-expanded="false" aria-controls="example-content">
                    <span class="flex justify-between items-center">Interactive Example Prompts <span class="text-2xl" id="example-icon">+</span></span>
                </button>
                <div id="example-content" class="collapsible-content space-y-4 p-4 border border-blue-100 dark:border-blue-700 rounded-b-lg">
                    <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300">Example 1: The Johnny Bravo Look</h3>
                    <p class="font-mono text-sm bg-gray-100 dark:bg-gray-700 p-3 rounded-md">mesomorph, broad shoulders, massive traps, (bulky arms:1.5), (slim legs:0.5), pompadour, blue eyes, [dynamic pose], [photorealistic]</p>
                    <button class="text-sm text-blue-500 hover:text-blue-700 underline" onclick="applyExamplePrompt(['mesomorph', 'broad shoulders', 'massive traps', 'bulky arms', 'slim legs', 'pompadour', 'blue eyes', 'dynamic pose', 'photorealistic'])" aria-label="Load Johnny Bravo example prompt">Click to load this prompt</button>
                    
                    <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300 pt-4">Example 2: Diverse Character (Dialysis Patient)</h3>
                    <p class="font-mono text-sm bg-gray-100 dark:bg-gray-700 p-3 rounded-md">endomorph, full figure, dialysis access site (fistula/graft), slim neck, soft skin, African heritage, deep skin tone, [natural light], [close-up]</p>
                    <button class="text-sm text-blue-500 hover:text-blue-700 underline" onclick="applyExamplePrompt(['endomorph', 'full figure', 'dialysis access site (fistula/graft)', 'slim neck', 'soft skin', 'African heritage', 'deep skin tone', 'natural light', 'close-up'])" aria-label="Load Diverse Character example prompt">Click to load this prompt</button>

                </div>
            </div>

            
            <div class="pt-8 border-t border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">Feedback & Contributions (Future Features)</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">
                    **User Contribution (Feature Concept):** To implement **User Contributions** (Feature 7), **Feedback Mechanism** (Feature 9), or **Accurate Token Estimation**, a secure **Backend API** and database (which we will start next week in Firebase) are required. The integrity of our vast glossary depends on this security layer!
                </p>
            </div>
            
        </section>

        <section id="utility-panel" class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg space-y-8" aria-labelledby="utility-panel-heading">
            <h2 id="utility-panel-heading" class="text-3xl font-bold text-gray-800 dark:text-gray-200 border-b pb-2">Utility Panels</h2>

            <div>
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Persona Presets</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Click a preset to instantly add a foundational set of keywords.</p>
                <div id="presets-panel" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    </div>
            </div>

            <div>
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Proportion Visualizer & Ratio Scaling</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Adjust values to emphasize features. Value is injected as (keyword:ratio). **(Default: 1.0)**</p>
                <div id="ratio-panel" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-6">
                    </div>
            </div>
            
            <div>
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Body Type Selector (Somatotype)</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Select the foundational body shape (Mutually Exclusive).</p>
                <div id="somatotype-panel" class="grid grid-cols-3 gap-4">
                    <button data-keyword="ectomorph" class="body-type-button py-3 px-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-blue-200 dark:hover:bg-blue-900 transition-colors" aria-pressed="false" tabindex="0">Ectomorph</button>
                    <button data-keyword="mesomorph" class="body-type-button py-3 px-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-blue-200 dark:hover:bg-blue-900 transition-colors" aria-pressed="false" tabindex="0">Mesomorph</button>
                    <button data-keyword="endomorph" class="body-type-button py-3 px-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-blue-200 dark:hover:bg-blue-900 transition-colors" aria-pressed="false" tabindex="0">Endomorph</button>
                </div>
            </div>
            
            <div class="border-t pt-8">
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Visual Body Mapper (High-Tech Silhouette)</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Click a region to jump to the relevant category in the glossary below.</p>
                <div id="svg-mapper-container" class="flex justify-center items-center h-96 relative" aria-label="Interactive Body Map">
                    <svg width="200" height="360" viewBox="0 0 200 360" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: scale(0.9);">
                        
                        <path class="body-path transform origin-center transition-transform" d="M100 10C115 10 120 25 120 40C120 55 100 65 100 65C100 65 80 55 80 40C80 25 85 10 100 10Z" 
                            onclick="smoothScrollTo('Hair-Styling')" aria-label="Hair and Styling"/>
                        
                        <path class="body-path transform origin-center transition-transform" d="M95 65L105 65L110 75C115 80 115 90 100 90C85 90 85 80 90 75L95 65Z" 
                            onclick="smoothScrollTo('Facial-Features')" aria-label="Facial Features"/>
                        
                        <path class="body-path transform origin-center transition-transform" d="M80 95C70 95 60 110 60 140C60 170 70 200 100 200C130 200 140 170 140 140C140 110 130 95 120 95L80 95Z" 
                            onclick="smoothScrollTo('Female-Anatomy')" aria-label="Torso, Chest, and Female Anatomy"/>

                        <path class="body-path transform origin-center transition-transform" d="M90 200C85 200 70 215 70 230L130 230C130 215 115 200 110 200L90 200Z" 
                            onclick="smoothScrollTo('Male-Anatomy')" aria-label="Waist and Male Abdomen Definition"/>
                        
                        <path class="body-path transform origin-center transition-transform" d="M70 230C55 240 50 260 55 280L145 280C150 260 145 240 130 230L70 230Z" 
                            onclick="smoothScrollTo('Lower-Body')" aria-label="Lower Body and Hips"/>

                        <path class="body-path transform origin-center transition-transform" d="M60 110L40 160L40 200L55 190L60 110Z" 
                            onclick="smoothScrollTo('Upper-Body')" aria-label="Arms and Upper Body"/>

                        <path class="body-path transform origin-center transition-transform" d="M60 280L50 350L150 350L140 280L60 280Z" 
                            onclick="smoothScrollTo('Lower-Body')" aria-label="Legs and Feet"/>

                        <text x="100" y="180" text-anchor="middle" font-size="12" fill="#1e40af">BODY MAP</text>

                    </svg>
                </div>
            </div>

        </section>

        <section id="glossary-container" class="space-y-10" aria-labelledby="glossary-content-heading">
            </section>
    </div>

<script>
    // --- Data: FULLY CONSOLIDATED MASTER DATA (All past chats integrated) ---

    const glossaryData = [
        // 1. Hair & Styling (Order 1.0)
        { 
            category: "Hair & Styling", 
            description: "Detailed characteristics for hair and head aesthetics.", 
            order: 1.0, 
            subcategories: [
                { name: "Hair Texture", groups: [{ group: "Texture", keywords: ["fine straight", "medium straight", "coarse straight", "silky smooth straight", "frizzy straight", "afro straight", "wavy straight", "soft waves", "loose waves", "beach waves", "tousled waves", "textured waves", "ringlets", "spiral curls", "bouncy curls", "soft curls", "kinky curls", "voluminous curls", "perm curls", "twist-out curls", "braid-out curls", "TWA coils", "afro coils", "mini coils", "dense coils", "springy coils", "coily twists", "natural shrinkage coils", "defined curls", "loose curls"] }]},
                { name: "Hair Length", groups: [{ group: "Length", keywords: ["pixie", "ear-length", "chin-length", "jaw-length", "short bob", "bob", "lob", "shoulder-length", "collarbone-length", "mid-back", "waist-length", "hip-length", "thigh-length", "floor-length"] }]},
                { name: "Hair Thickness", groups: [{ group: "Thickness", keywords: ["micro", "thin", "fine", "medium", "thick", "dense", "full", "heavy", "jumbo", "chunky", "layered", "multi-layered"] }]},
                { name: "Hair Color", groups: [{ group: "Color", keywords: ["black", "natural black", "dark brown", "medium brown", "light brown", "chestnut", "auburn", "mahogany", "red", "golden brown", "blonde", "platinum blonde", "ash blonde", "honey blonde", "strawberry blonde", "balayage brown-blonde", "ombré", "dip-dye", "highlights", "lowlights", "peekaboo highlights", "two-tone", "bronde", "pastel pink", "lavender", "baby blue", "mint green", "neon streaks", "rainbow", "silver", "grey highlights", "ombre pastel", "bronze highlights"] }]},
                { name: "Hair Parting", groups: [{ group: "Parting", keywords: ["center part", "deep center part", "side part left", "side part right", "deep side part", "middle part", "zig-zag part", "C-part", "invisible part", "curved part", "hard part", "soft part", "boxed part", "triangle parts", "diamond parts", "star part", "peekaboo part"] }]},
                { name: "Bangs & Hairline", groups: [{ group: "Bangs/Hairline", keywords: ["no bangs", "straight fringe", "curtain bangs", "swooped bangs", "asymmetrical bangs", "feathered bangs", "micro bangs", "side-swept bangs", "pre-plucked hairline", "natural hairline", "baby hairs laid", "subtle baby hairs", "dramatic baby hairs", "swooped edges", "laid edges"] }]},
                { name: "Hair Accessories", groups: [{ group: "Accessories", keywords: ["hair clips", "barrettes", "pins", "ribbons", "scrunchies", "elastic bands", "beads", "threads", "hair cuffs", "hair rings", "decorative pins", "flowers", "headbands", "scarves", "wraps", "decorative combs", "hair jewelry", "tinsel strands", "feathers", "oversized barrettes (colorful)", "African hair beads", "crochet braid style", "hair charms", "ribbon bow (oversized)", "diamond-encrusted barrettes", "silk head wrap", "hairpins", "bandanas", "hair ties", "flower crowns", "hair cuffs", "claw clips", "hair nets", "tiaras", "bobby pins", "hairbands"] }]},
                { name: "Hair Patterns & Finishes", groups: [{ group: "Patterns/Finishes", keywords: ["curl ends", "feathered tips", "soft waves", "sleek finish", "tousled finish", "spiral curls", "highlighted tips", "ombre tips", "spray stencil pattern", "painted streaks", "dip-dye tips", "dipped ends", "crimped texture", "pressed sleek", "matte finish", "glossy finish"] }]},
                { name: "Hair Movement", groups: [{ group: "Movement", keywords: ["flowing hair", "windblown", "messy", "perfectly styled"] }]},
                { name: "Hairline Types", groups: [{ group: "Hairline Types", keywords: ["low hairline", "high hairline", "widow's peak", "straight hairline", "M-shaped hairline", "receding temples", "high forehead line", "low forehead line", "straight block hairline", "soft rounded hairline", "v-shaped hairline", "temple recession", "natural widow's peak", "defined edges", "laid baby hairs", "wispy hairline", "full frontal hairline", "natural curl hairline", "crisp shape-up"] }]}
            ]
        },
        // 2. Facial Features (Order 2.0)
        { 
            category: "Facial Features", 
            description: "Keywords for detailing the face and neck.", 
            order: 2.0, 
            subcategories: [
                { name: "Eyes", groups: [{ group: "Shape & Color", keywords: ["blue eyes", "green eyes", "almond shaped eyes", "piercing gaze", "hooded eyes", "doe eyes", "monolid", "double eyelid", 'deep-set eyes', 'round eyes (large)', 'narrow eyes', 'wide-set eyes', 'youthful gaze', 'aged eyes', 'Eye spacing', 'Iris size', 'Pupil dilation', 'Eyelid shape (monolid)', 'Eyelid shape (double lid)', 'Eyelid shape (hooded)', 'almond eyes (Asian)', 'large round eyes (West African)', 'slanted eyes', 'epicanthic fold', 'prominent orbital bone', 'fox eyes', 'thin delicate eyelashes', 'thick mascara lashes'] }]},
                { name: "Nose", groups: [{ group: "Nose Shape", keywords: ["small nose", "roman nose", "button nose", "aquiline nose", "wide nose", 'small bridge nose', 'slender bridge', 'hooked nose', 'defined nose tip', 'Nose bridge height', 'Nostril flare'] }]},
                { name: "Lips", groups: [{ group: "Mouth/Lips", keywords: ["full lips", "thin lips", "pouty", "sharp smile", "smirking", "cupid's bow", 'Lip cupid\'s bow definition', 'Lip corner position (upturned)', 'Lip corner position (neutral)', 'Lip corner position (downturned)'] }]},
                { name: "Ears", groups: [{ group: "Ear Shape", keywords: ["small ears", "large ears", "piercings", "pointy ears (fantasy)", "tapered ears"] }]},
                { name: "Nostrils", groups: [{ group: "Nostrils", keywords: ["flared nostrils", "narrow nostrils", "subtle nostrils"] }]},
                { name: "Jawline", groups: [{ group: "Jawline", keywords: ["sharp jawline", "soft jawline", "chiseled jaw", "square jaw", "v-shaped jaw", 'rounded jaw', 'angular features', 'defined mandible'] }]},
                { name: "Chin", groups: [{ group: "Chin", keywords: ["strong chin", "receding chin", "dimpled chin", "pointed chin", "square chin", 'prominent chin', 'cleft chin'] }]},
                { name: "Cheeks", groups: [{ group: "Cheeks", keywords: ["high cheekbones", "rosy cheeks", "sunken cheeks", "full cheeks", "chubby cheeks", 'prominent cheekbones', 'soft features', 'puffy face', 'gaunt face'] }]},
                { name: "Neck", groups: [{ group: "Neck", keywords: ["long neck", "thick neck", "slender neck", "adam's apple (male)", "defined collarbones", 'slim neck', 'graceful neck', 'delicate neck', 'toned neck'] }]},
                { name: "Micro-Features & Symmetry", groups: [
                    { group: "Forehead & Brow Ridge", keywords: ["prominent brow ridge", "sloping forehead", "flat forehead", "smooth temples", 'thin eyebrows (plucked)', 'thick brows (natural)', 'unibrow', 'Eyebrow arch position', 'heavy brow furling', 'single furling line', 'fine eyelid creases', 'deep-set eye orbital'] },
                    { group: "Facial Symmetry", keywords: ["high symmetry face", "youthful symmetry", "aged symmetry", "asymmetrical face", "facial thirds defined", "Philtrum defined", "Facial Symmetry Modifiers"] }
                ]}
            ]
        },
        // 3. Female Anatomy (Order 3.0)
        { 
            category: "Female Anatomy", 
            description: "Detailed characteristics specific to the female form. (Gender-Neutral Compatible)", 
            order: 3.0, 
            subcategories: [
                // Breasts Size & Shape (FULLY POPULATED FROM PREVIOUS CHATS)
                { name: "Breasts (General Size)", groups: [
                    { group: "Small Breasts", keywords: ["petite bust", "delicate bust", "subtle bust", "slight bust", "modest bust", "flat bust", "compact bust", "dainty bust", "narrow bust", "graceful bust", "fine bust", "light bust", "minimal bust", "slender bust", "petite chest", "delicate chest", "subtle chest", "flat chest", "compact chest", "dainty chest", "narrow chest", "graceful chest", "fine chest", "light chest", "minimal chest", "slender chest", "petite figure", "slight figure", "modest figure", "flat figure", "compact figure", "slender figure", "petite frame", "delicate frame", "narrow frame", "slender frame", "light frame"] },
                    { group: "Medium Breasts", keywords: ["balanced bust", "moderate bust", "average bust", "normal bust", "proportional bust", "natural bust", "rounded bust", "classic bust", "centered bust", "steady bust", "harmonious bust", "tasteful bust", "symmetrical bust", "refined bust", "aesthetic bust", "elegant bust", "balanced chest", "moderate chest", "average chest", "normal chest", "proportional chest", "rounded chest", "classic chest", "centered chest", "symmetrical chest", "natural silhouette", "refined silhouette", "harmonious figure", "balanced figure", "rounded figure", "classic figure", "centered figure", "natural figure"] },
                    { group: "Large Breasts", keywords: ["full bust", "ample chest", "voluptuous curve", "dramatic cleavage", "rounded fullness", "deep bustline", "enhanced projection", "abundant chest volume", "curvaceous bust", "generous bustline", "lifted full bust", "defined round chest", "mature bust fullness", "youthful bust abundance", "natural large bust shape", "symmetrical full bust", "dramatic proportion", "sculpted chest silhouette", "enhanced cleavage line", "deep chest shadow", "highlighted full bust contour", "firm large bust", "soft abundant chest", "natural generous projection", "heavy bustline", "rounded mature chest", "abundant bust symmetry", "lifted bust with fullness", "proportionate large bust", "highlighted bust curve", "dramatic chest profile", "deep rounded cleavage", "sculpted bust abundance", "elegant chest volume", "defined bust highlight", "symmetrical full projection", "enhanced lift with fullness", "graceful large bust contour", "mature round bust shape", "voluptuous symmetry", "natural chest abundance", "highlighted cleavage shadow", "abundant feminine bustline", "defined bust silhouette", "full contour lift", "dramatic chest symmetry", "elegant rounded profile", "highlighted feminine chest shape", "sculpted chest prominence", "natural bust roundness", "deep cleavage emphasis", "proportionate abundant bust", "symmetrical round fullness", "graceful bust dimension", "dramatic bust taper", "enhanced rounded projection", "highlighted chest lift", "abundant bust harmony", "curvaceous feminine chest profile", "elegant full bust balance", "natural large bust silhouette", "lifted bust projection", "highlighted full bust tone", "sculpted mature chest", "rounded bust with abundance", "proportionate heavy bust", "dramatic bust curve", "graceful projection outline", "abundant bust slope", "natural full bust highlight", "symmetrical bust shadow", "highlighted dramatic cleavage", "firm large projection", "enhanced contour bustline", "elegant curvaceous chest profile", "lifted abundant bustline", "refined bust shape fullness", "graceful large chest taper", "highlighted bust round profile", "voluptuous feminine contour", "mature bust abundance", "youthful large bust balance", "sculpted chest prominence line", "natural generous bust silhouette", "dramatic round chest balance", "highlighted cleavage prominence", "elegant bust symmetry", "proportionate chest roundness", "abundant bust projection harmony", "highlighted feminine bustline", "graceful large bust highlight", "full chest symmetry", "dramatic curvaceous profile", "natural enhanced bust lift"] }
                ]},
                { name: "Breast Shape", groups: [
                    { group: "Surgical Shapes", keywords: ["teardrop shape", "gummy bear shape", "round implant silhouette", "anatomical contour", "high profile projection", "low profile slope", "full upper pole", "natural taper", "wide base bust", "narrow base bust", "sloped teardrop", "projected roundness", "soft anatomical shape", "firm implant contour", "enhanced cleavage shape", "sculpted bust silhouette"] },
                    { group: "Natural Shapes", keywords: ["asymmetrical bust", "natural sag", "gentle slope", "full lower pole", "rounded natural contour", "soft bust shape", "mature bust silhouette", "youthful perkiness", "natural bust taper", "slightly uneven bustline", "organic bust form", "subtle natural projection"] }
                ]},
                { name: "Waist & Torso", groups: [
                    { group: "Small/Cinched Waist", keywords: ["slim waist", "tapered torso", "hourglass waist", "narrow waist", "tiny waist", "cinched waist"] },
                    { group: "Medium/Balanced Waist", keywords: ["athletic midsection", "soft curve", "defined waistline", "natural taper", "proportional waist"] },
                    { group: "Large/Broad Waist", keywords: ["broad waist", "straight waist", "long waist", "short waist"] }
                ]},
                { name: "Hips", groups: [
                    { group: "Hip Descriptors", keywords: ["narrow hips", "slim hips", "petite hips", "compact hips", "broad hips", "wide hips", "generous hips", "full hips", "ample hips", "expansive hips", "voluminous hips", "balanced hips", "average hips", "natural hips", "rounded hips", "curved hips", "heart-shaped hips", "pear-shaped hips", "diamond-shaped hips", "square hips", "boxy hips", "sculpted hips", "streamlined hips", "symmetric hips", "hip dips", "slight hip dips", "deep hip dips", "smooth hip line", "pelvic curve", "waist-to-hip curve", "athletic hips", "toned hips", "sculpted hips", "soft hips", "gentle hips", "feminine hips", "elegant hips", "youthful hips", "mature hips", "BBL hips", "enhanced hips", "natural BBL hips", "dramatic BBL hips", "graceful hips", "harmonious hips", "dramatic hips", "highlighted hips", "defined hips", "stylized hips"] }
                ]},
                { name: "Navel Types", groups: [
                    { group: "Navel Definition", keywords: ["innie navel", "outie navel", "T-shaped navel", "vertical navel", "horizontal navel", "subtle navel", "prominent navel"] }
                ]}
            ]
        },
        // 4. Male Anatomy (Order 4.0)
        { 
            category: "Male Anatomy", 
            description: "Detailed characteristics specific to the male form. (Gender-Neutral Compatible)", 
            order: 4.0, 
            subcategories: [
                { name: "Chest & Torso", groups: [
                    { group: "Chest Build", keywords: ["broad chest", "toned torso", "muscular build", "defined pecs", "flat chest", "sculpted upper body", "lean chest", "athletic torso", "full chest", "compact torso", "wide chest", "expansive chest", "generous chest", "ample chest", "barrel chest", "robust chest", "narrow chest", "slim chest", "petite chest", "slight chest", "delicate chest", "trim chest"] },
                    { group: "Torso Shape", keywords: ["rectangular torso", "square torso", "straight torso", "linear torso", "elongated torso", "slender torso", "V-shaped torso", "V-taper torso", "inverted triangle torso", "classic triangle torso", "hourglass torso (male build)", "rounded torso", "broad-shouldered torso", "narrow-shouldered torso"] }
                ]},
                { name: "Muscle Definition", groups: [
                    { group: "Muscle Types", keywords: ["lean muscle", "bulky muscle", "toned muscle", "vascular build", "sculpted physique", "defined abs", "broad shoulders", "cut arms", "tight core", "powerful frame", 'ripped physique', 'shredded definition', 'hyper-muscular', 'low body fat', 'extreme definition', 'bodybuilder physique', 'mass monster', 'aesthetic physique', 'thick muscle bellies', 'dense and hard muscle', 'crossfit build', 'calisthenics build', 'granite-like muscles', 'striated muscle tissue'] }
                ]},
                { name: "Abdomen Definition", groups: [
                    { group: "Core Definition", keywords: ["flat stomach", "toned stomach", "soft abdomen", "defined abs", "subtle abs", "sculpted core", "six-pack defined", "washboard abs", "smooth stomach", "rounded gut"] }
                ]},
                { name: "Male Arms (Size)", groups: [
                    { group: "Small/Slender Arms", keywords: ["slim arms", "narrow arms", "lean arms", "slender arms", "delicate arms", "trim arms", "thin forearms", "light arms"] },
                    { group: "Medium/Balanced Arms", keywords: ["average arms", "balanced arms", "moderate arms", "proportional arms", "toned arms", "fit arms", "runner’s arms"] },
                    { group: "Large/Bulky Arms", keywords: ["broad arms", "thick arms", "strong arms", "robust arms", "hefty arms", "sturdy arms", "bulky arms", "defined biceps", "muscular arms", "bodybuilder arms", "powerful arms"] }
                ]},
                { name: "Male Legs (Size)", groups: [
                    { group: "Small/Slim Legs", keywords: ["slim legs", "slender legs", "lean legs", "narrow legs", "long legs (thin)", "short legs (compact)", "compact legs", "trim calves"] },
                    { group: "Medium/Athletic Legs", keywords: ["balanced legs", "toned legs", "athletic legs", "runner’s legs", "soccer legs", "defined calves", "slim calves"] },
                    { group: "Large/Muscular Legs", keywords: ["broad legs", "thick legs", "sturdy legs", "muscular legs", "powerful legs", "robust legs", "bodybuilder legs", "muscular calves", "thick thighs"] }
                ]},
                { name: "Male Back & Shoulders", groups: [
                    { group: "Back & Shoulder Descriptors", keywords: ["broad shoulders", "wide shoulders", "expansive shoulders", "generous shoulders", "square shoulders", "narrow shoulders", "slim shoulders", "compact shoulders", "delicate shoulders", "balanced shoulders", "average shoulders", "angular shoulders", "rounded shoulders", "sloped shoulders", "straight shoulders", "classic V-shape shoulders", "inverted triangle shoulders", "athletic shoulders", "heroic shoulders", "regal shoulders", "sculpted shoulders", "toned shoulders", "defined shoulders", "strong shoulders", "muscular shoulders", "firm shoulders", "solid shoulders", "powerful shoulders", "fit shoulders", "statuesque shoulders", "tailored shoulders", "suit shoulders", "armor shoulders", "model shoulders", "runway shoulders", "fashion shoulders", "symmetrical shoulders", "proportional shoulders", "refined shoulders", "aesthetic shoulders", "broad back", "wide back", "expansive back", "generous back", "robust back", "narrow back", "slim back", "lean back", "compact back", "balanced back", "average back", "V-shaped back", "tapered back", "rectangular back", "elongated back", "straight back", "arched back", "rounded back", "angular back", "classic taper back", "dramatic taper back", "subtle taper back", "sculpted back", "toned back", "defined back", "muscular back", "athletic back", "firm back", "strong back", "heroic back", "powerful back", "statuesque back", "model back", "runner’s back", "swimmer’s back", "warrior’s back", "tailored back", "suit back", "fitted back", "runway back", "fashion back", "armor back", "classic back", "modern back", "aesthetic back", "smooth back", "symmetrical back", "refined back", "polished back", "structured back", "harmonious back"] }
                ]}
            ]
        },
        // 5. Upper Body (Order 5.0)
        { 
            category: "Upper Body", 
            description: "Features common to both sexes, focusing on arms and shoulders.", 
            order: 5.0, 
            subcategories: [
                { name: "Shoulders", groups: [{ group: "Shoulders", keywords: ["broad shoulders", "narrow shoulders", "sloping shoulders", "defined traps", 'rounded shoulders', 'sculpted shoulders', 'sloped shoulders', 'delicate shoulders', 'feminine shoulders', 'athletic shoulders', 'highlighted shoulders'] }]},
                { name: "Arms", groups: [{ group: "Arm Shape", keywords: ["muscular arms", "toned arms", "slim arms", "strong arms", "veiny arms", "bicep definition", 'slender arms', 'delicate arms', 'graceful arms', 'athletic arms', 'feminine arms', 'slim forearms', 'toned forearms', 'sculpted forearms', 'delicate forearms', 'supple forearms', 'long arms', 'short arms', 'compact arms', 'highlighted arms', 'shadowed arms', 'Forearm Musculature', 'Wrist Structure', 'Elbow Definition'] }]},
                { name: "Hands", groups: [{ group: "Hand Detail", keywords: ["delicate hands", "large hands", "veiny hands", "manicured nails", "knuckles", "holding object", 'proportionate hands', 'hairy hands', 'smooth hands', 'oily hands', 'calloused hands', 'hands with visible folds', 'strong grip hands', 'large hands', 'small hands', 'long fingers'] }]},
                { name: "Chest", groups: [{ group: "General Chest", keywords: ["toned chest", "deep cleavage (female)", "flat chest (male)", "defined pecs (male)", 'Collarbone/Clavicle Prominence', 'Deltoid Definition'] }]},
                { name: "Back", groups: [{ group: "Back Detail", keywords: ["toned back", "muscular back", "defined lats", "shoulder blades", "spinal groove", 'slim back', 'soft back', 'supple back', 'delicate back', 'narrow back', 'broad back', 'proportionate back', 'upper back defined', 'mid-back sculpted', 'lower back toned', 'lower back with dimples', 'highlighted spine line', 'subtle spine line', 'arched back', 'dramatic arch', 'elegant arch'] }]},
                { name: "Functional & Medical Modifiers", groups: [
                    { group: "Asymmetry & Medical Detail", keywords: ["dialysis access site (fistula/graft)", "port catheter area", "asymmetrical muscle mass", "prosthetic arm", "limb atrophy", "scar tissue (functional)"] }
                ]}
            ]
        },
        // 6. Lower Body (Order 6.0)
        { 
            category: "Lower Body", 
            description: "Features common to both sexes, focusing on the lower half.", 
            order: 6.0, 
            subcategories: [
                { name: "Glutes", groups: [{ group: "Glute Shape", keywords: ["round glutes", "large glutes", "small glutes", "toned buttocks", "curvy lower body", 'flat buttocks', 'minimal projection', 'narrow rear', 'tight glutes', 'average projection glutes', 'rounded shape glutes', 'proportional glutes', 'ample buttocks', 'full projection glutes', 'voluminous glutes', 'heavy-set behind'] }]},
                { name: "Thighs", groups: [{ group: "Thigh Shape", keywords: ["thick thighs", "slim thighs", "toned thighs", "muscular quads", 'thunder thighs', 'cellulite texture on thighs', 'lean quads', 'muscular hammies', 'long femoral length', 'athletic legs', 'smooth legs', 'hairy legs', 'curvaceous thighs', 'athletic thighs', 'slender thighs', 'powerful thighs', 'feminine thighs'] }]},
                { name: "Legs", groups: [{ group: "Leg Shape", keywords: ["long legs", "curvy legs", "muscular legs", "slim calves", "defined shins", 'slim legs', 'short legs', 'athletic legs', 'toned legs', 'sculpted legs', 'supple legs', 'delicate legs', 'petite legs', 'proportionate legs', 'smooth legs', 'hairy legs', 'cellulite texture', 'freckled legs', 'scarred legs', 'glowing legs', 'elegant thighs', 'dramatic thighs'] }]},
                { name: "Calves", groups: [{ group: "Calf Definition", keywords: ["defined calves", "muscular calves", "slender lower leg", "toned calves", 'gastrocnemius definition'] }]},
                { name: "Ankles & Feet", groups: [
                    { group: "Feet Detail", keywords: ["small feet", "large feet", "manicured toenails", "barefoot", "detailed soles", 'Foot Arch Types'] },
                    { group: "Ankle Structure", keywords: ["thin ankles", "thick ankles", "defined bone structure"] }
                ]},
                { name: "Hip-to-Waist Transition", groups: [
                    { group: "Transition Zones", keywords: ["smooth hip-to-waist curve", "sharp hip-to-waist taper", "gentle side-slope"] }
                ]}
            ]
        },
        // 7. Skin & Surface (Order 7.0)
        { 
            category: "Skin & Surface", 
            description: "Fine details related to the character's skin and markings.", 
            order: 7.0, 
            subcategories: [
                { name: "Skin Tone", groups: [{ group: "Tone", keywords: ["porcelain skin", "tanned skin", "dark skin", "fair skin", "ebony skin", "almond skin", 'golden skin', 'olive skin', 'brown skin', 'deep skin'] }]},
                { name: "Undertones", groups: [{ group: "Undertones", keywords: ["warm undertones", "cool undertones", "neutral undertones", "rosy cheeks"] }]},
                { name: "Texture", groups: [{ group: "Texture", keywords: ["smooth skin", "pitted skin", "oily skin", "dry skin", "flawless skin", 'rough skin', 'coarse skin', 'Pore Visibility'] }]},
                { name: "Glow & Finish", groups: [{ group: "Glow/Finish", keywords: ["glowing skin", "matte finish", "dewy skin", "subtle glow", "shimmering skin", 'radiant skin', 'polished skin', 'Oil/Moisture Levels (matte)', 'Oil/Moisture Levels (dewy)', 'Oil/Moisture Levels (glossy)'] }]},
                { name: "Markings & Scars", groups: [{ group: "Markings/Scars", keywords: ["scars", "blemishes", "birthmark", "tattoos", "stretch marks", 'acne scars', 'dimpled skin', 'moles on skin', 'beauty marks', 'Tattoo Descriptors', 'Birthmarks', 'Stretch Marks'] }]},
                { name: "Freckle Maps", groups: [{ group: "Freckles", keywords: ["scattered freckles", "freckles across nose", "heavy freckles", "subtle freckles", 'freckled skin'] }]},
                { name: "Vein Visibility", groups: [{ group: "Veins", keywords: ["subtle vein visibility", "prominent veins", "blue veins", "delicate veins"] }]},
                { name: "Transitional Zones", groups: [
                    { group: "Body Connections", keywords: ["smooth muscle-to-bone transition", "soft tissue overlap", "defined joint appearance", "seamless anatomical blend"] }
                ]}
            ]
        },
        // 8. Clothing Fit & Style (Order 8.0)
        { 
            category: "Clothing Fit & Style", 
            description: "Keywords to control how the clothing drapes and interacts with the body, including accessories.", 
            order: 8.0, 
            subcategories: [
                { name: "Silhouette Fit", groups: [{ group: "Fit", keywords: ["form-fitting", "skin-tight", "oversized", "baggy clothes", "tailored suit", "flowing robe"] }]},
                { name: "Fabric Flow", groups: [{ group: "Flow/Drape", keywords: ["draped fabric", "wrinkled fabric", "silk smooth", "heavy cotton texture", "translucent cloth"] }]},
                { name: "Fashion Context", groups: [{ group: "Context", keywords: ["haute couture", "streetwear", "casual clothes", "formal wear", "sports attire"] }]},
                { name: "Pose & Movement", groups: [{ group: "Movement", keywords: ["wind-swept clothes", "dynamic folds", "fabric motion", "billowing cape"] }]},
                { name: "Era-Based Fashion", groups: [{ group: "Era/Style", keywords: ["victorian dress", "1950s fashion", "cyberpunk aesthetic", "steampunk gear"] }]},
                { name: "Function-Based Fit", groups: [{ group: "Function", keywords: ["military uniform", "plate armor", "wet clothes", "damaged uniform", "doctor scrubs", "chef coat and hat", "flight attendant uniform", "police officer uniform", "schoolgirl uniform (Japanese style)", "high school jacket", "military dress uniform"] }]},
                { name: "Cinematic Silhouettes", groups: [{ group: "Cinematic", keywords: ["defined silhouette", "shadowed figure", "backlit silhouette"] }]},
                { name: "Tech & Carry Accessories", groups: [
                    { group: "Tech Gear", keywords: ["AirPods in ear", "oversize sunshades", "cat-eye sunglasses", "Bluetooth headset", "smartwatch (digital)", "smartwatch (analog)", "high heel crocs", "smartphone", "tablet", "laptop", "earbuds", "Bluetooth speaker", "camera", "power bank", "fitness tracker", "VR headset", "smart glasses", "stylus pen", "flash drive", "cables", "phone case", "camera bag", "wireless charger", "gaming console", "smart speaker", "digital notebook", "removable storage"] },
                    { group: "Carry Items", keywords: ["phone charm", "leather clutch", "designer handbag", "luxury briefcase", "suede satchel", "tote bag", "crossbody bag", "messenger bag", "briefcase", "duffel bag", "luggage", "weekender bag", "packing cubes", "notebooks", "water bottles", "tech organizers"] }
                ]},
                { name: "Jewelry & Luxury", groups: [
                    { group: "Fine Jewelry", keywords: ["24k gold chain (heavy)", "10k tennis bracelet", "VVS diamond watch", "Cartier Tank watch", "Rolex Submariner", "Bulgari Serpenti bracelet", "pearl drop earrings", "layered necklaces", "heavy silver cuffs", "sapphire ring", "ruby encrusted", "platinum band", "pave set diamonds"] },
                    { group: "Belts & Wallets", keywords: ["leather belt", "fabric belt", "woven belt", "decorative buckle belt", "wide cinch belt", "credit card holder", "bi-fold wallet", "zippered wallet", "coin purse", "clutch wallet"] }
                ]},
                { name: "Texture Layering", groups: [
                    { group: "Material Interaction", keywords: ["smooth texture on rough fabric", "skin to fabric transition", "multiple surface qualities", "texture transition zones"] }
                ]},
                { name: "Outfits & Footwear", groups: [
                    { group: "Shirts & Tops", keywords: ["t-shirt", "button-down shirt", "hoodie", "tank top", "blouse", "sweater", "formal shirt", "crop top", "graphic tee", "chambray shirt", "flannel shirt"] },
                    { group: "Bottoms", keywords: ["pants", "jeans", "skirt", "shorts", "skort", "leggings", "slacks", "swim trunks", "cargo pants", "skinny jeans", "overalls"] },
                    { group: "Shoes & Boots", keywords: ["sandals", "tennis shoes", "formal shoes", "high heels", "pumps", "red bottoms shoes", "boots", "flats", "sneakers", "hiking boots", "rain boots", "flip-flops", "ballet flats", "military boots", "platform shoes"] },
                    { group: "Outerwear", keywords: ["maxi dress", "bodycon dress", "puffer jacket", "sundress", "tailored suit", "athleisure wear", "winter coats", "light jackets"] }
                ]},
                { name: "Style, Makeup, & Seasonal", groups: [
                    { group: "Makeup", keywords: ["natural look (makeup)", "minimal makeup", "nude tones", "dewy finish", "glam look (makeup)", "bold lipstick", "dramatic eyes", "contouring", "artistic makeup", "face painting", "avant-garde styles", "colorful eyeliner", "vibrant eyeliner shades"] },
                    { group: "Seasonal/Functional", keywords: ["summer wear", "winter clothing", "fall fashion", "spring attire", "winter hats", "summer sunglasses", "functional accessories", "fashion accessories", "statement jewelry", "designer items", "scarves", "hats", "gloves", "umbrellas", "watches", "sunglasses", "bandanas"] }
                ]}
            ]
        },
        // 9. Fantasy & Stylized Anatomy (Order 9.0)
        { 
            category: "Fantasy & Stylized Anatomy", 
            description: "Keywords for non-human and stylized physical traits.", 
            order: 9.0, 
            subcategories: [
                { name: "Species Traits", groups: [{ group: "Species", keywords: ["elven ears", "dragon scales", "feathered wings", "furry tail", "cloven hooves"] }]},
                { name: "Hybrid Features", groups: [{ group: "Hybridization", keywords: ["half-elf", "cat ears and tail", "demonic horns", "angel wings"] }]},
                { name: "Stylized Proportions", groups: [{ group: "Stylization", keywords: ["chibi proportions", "exaggerated features", "comic book physique", "anime style eyes"] }]},
                { name: "Magical Modifiers", groups: [{ group: "Magic", keywords: ["glowing runes", "magical aura", "arcane tattoos", "crystal skin"] }]},
                { name: "Elemental Traits", groups: [{ group: "Elemental", keywords: ["fire hair", "ice skin", "stone texture", "water body"] }]}
            ]
        },
        // 10. Emotional & Expressive Layers (Order 10.0)
        { 
            category: "Emotional & Expressive Layers", 
            description: "Tags to influence mood, facial expression, and body language.", 
            order: 10.0, 
            subcategories: [
                { name: "Mood Tags", groups: [{ group: "Mood", keywords: ["melancholy", "joyful", "pensive", "dramatic lighting", "gloomy atmosphere", "intense", "Introverted (reserved)", "Extroverted (outgoing)", "Creative (artistic)", "Analytical (logical)", "Empathetic (compassionate)"] }]},
                { name: "Facial Emotion", groups: [{ group: "Expression", keywords: ["smiling", "frowning", "fierce expression", "subtle smirk", "crying", "staring intently", "Joyful (beaming smile)", "Sad (downturned mouth, teary eyes)", "Angry (clenched jaw, narrowed eyes)", "Surprised (raised eyebrows)", "Confused (tilted head)", "Flirty (playful smile, winking)"] }]},
                { name: "Body Language", groups: [{ group: "Body Language", keywords: ["confident posture", "crouching", "relaxed pose", "hands on hips", "crossed arms", "dynamic pose", "Athletic (toned muscles)", "Curvy (fuller figure)", "Petite (small stature)", "Stocky (broader frame)", "Lean (slim figure)", "Plus-size (curvier body)", "Muscular (strong build)"] }]},
                { name: "Gesture & Hand Positions", groups: [
                    { group: "Hand Poses", keywords: ["open palm", "fist", "pointing", "delicate hold", "finger articulation spread", "finger articulation curled", "finger articulation interlaced", "hands on hips (confident)", "hand tucked in pocket", "finger gun gesture", "delicate hand gesture", "hip cocked (side stance)", "foot tapping (impatient)", "shoulders hunched (anxious)", "crossed arms (defensive)", "leaning forward (interested)", "pointing finger (directive)", "head tilt (curious)", "smiling with hands clasped", "fingers running through hair", "thumbs up (approval)", "peace sign (friendly)", "open hands (welcoming)"] },
                    { group: "Body Positioning", keywords: ["Wrist Angles", "Arm Positioning Relative to Body"] }
                ]},
                { name: "Dynamic States & Conditions", groups: [
                    { group: "Muscle & Breathing", keywords: ["Muscle Tension (flexed)", "Muscle Tension (relaxed)", "Muscle Tension (engaged)", "Breathing States (inhaled)", "Breathing States (exhaled)", "Breathing States (neutral)"] },
                    { group: "Postural Alignment", keywords: ["Weight Distribution (standing)", "Weight Distribution (sitting)", "Weight Distribution (leaning)", "neutral spine", "arched spine", "slouched posture"] }
                ]}
            ]
        },
        // 11. Cultural & Historical Archetypes (Order 11.0)
        { 
            category: "Cultural & Historical Archetypes", 
            description: "Descriptors for clothing and character looks based on time period or region.", 
            order: 11.0, 
            subcategories: [
                { name: "Cultural Body Ideals", groups: [{ group: "Ideals", keywords: ["renaissance figure", "geisha proportions", "nordic warrior", "ancient greek statue"] }]},
                { name: "Historical Silhouettes", groups: [{ group: "Silhouettes", keywords: ["18th century corset", "medieval tunic", "flapper dress", "art deco style"] }]},
                { name: "Regional Traits", groups: [{ group: "Regional", keywords: ["east asian features", "mediterranean features", "celtic features", "african features"] }]},
                { name: "Cultural Attire", groups: [{ group: "Traditional Clothing", keywords: ["kimono", "sari", "dashiki", "modern cultural blends", "urban streetwear", "carnival costumes", "cultural festival attire"] }]}
            ]
        },
        // 12. Age & Hormonal Modifiers (Order 12.0)
        { 
            category: "Age & Hormonal Modifiers", 
            description: "Keywords to influence the appearance of age and maturity.", 
            order: 12.0, 
            subcategories: [
                { name: "Youthful Traits", groups: [{ group: "Youthful", keywords: ["smooth skin", "full cheeks", "innocent expression", "childlike"] }]},
                { name: "Mature Traits", groups: [{ group: "Mature", keywords: ["mid-aged", "defined features", "subtle wrinkles", "experienced look"] }]},
                { name: "Aged Features", groups: [{ group: "Aged", keywords: ["deep wrinkles", "grey hair", "crows feet", "weathered skin", "elderly"] }]},
                { name: "Hormonal Influence", groups: [{ group: "Hormonal", keywords: ["masculine features", "androgynous", "soft feminine features", "broad shoulders (female)"] }]}
            ]
        },
        // 13. Scene & Environment Context (Order 13.0)
        { 
            category: "Scene & Environment Context", 
            description: "Tags for placing the character in a setting and controlling scene elements.", 
            order: 13.0, 
            subcategories: [
                { name: "Location Tags", groups: [{ group: "Location", keywords: ["forest setting", "cyberpunk city", "ancient temple", "bar interior", "desert landscape"] }]},
                { name: "Lighting Styles", groups: [{ group: "Lighting", keywords: ["rim lighting", "volumetric lighting", "soft studio lighting", "dramatic shadows", "neon glow"] }]},
                { name: "Camera Angles", groups: [{ group: "Camera", keywords: ["full body shot", "close up", "dynamic pose", "low angle", "dutch angle", "side view"] }]},
                { name: "Background Elements", groups: [{ group: "Background", keywords: ["minimalist background", "detailed background", "blurred background", "bokeh effect"] }]},
                { name: "Lighting Interaction Calculator (Concept)", groups: [
                    { group: "Shadow/Highlight Guidance", keywords: ["light source position: high", "light source position: low", "shadow placement guides", "highlight zones by pose"] }
                ]},
                { name: "Movement & Physics Simulator (Concept)", groups: [
                    { group: "Physics Control", keywords: ["Hair physics in motion", "Fabric drape and flow", "Muscle engagement during action", "Gravitational effects on soft tissue"] }
                ]}
            ]
        },
        // 14. Technical Rendering Tags (Order 14.0)
        { 
            category: "Technical Rendering Tags", 
            description: "Keywords for achieving high-quality, specific artistic outputs.", 
            order: 14.0, 
            subcategories: [
                { name: "Rendering Engines", groups: [{ group: "Engines", keywords: ["unreal engine", "octane render", "blender render", "raytracing"] }]},
                { name: "Aspect Ratios", groups: [{ group: "Ratio", keywords: ["16:9 aspect ratio", "3:2 aspect ratio", "square ratio"] }]},
                { name: "Style Filters", groups: [{ group: "Style", keywords: ["photorealistic", "digital painting", "line art", "cel shaded", "oil painting"] }]},
                { name: "Output Formats", groups: [{ group: "Quality", keywords: ["4k", "8k", "highly detailed", "masterpiece", "trending on artstation", "sharp focus"] }]}
            ]
        },
        // 15. Prompt Formatting & Emphasis (Order 15.0)
        { 
            category: "Prompt Formatting & Emphasis", 
            description: "Tips for using the advanced features and prompt syntax effectively.", 
            order: 15.0, 
            subcategories: [
                { name: "Ratio Syntax", groups: [{ group: "Syntax", keywords: ["(keyword:ratio)", "use ratio panel", "numerical weighting"] }]},
                { name: "Emphasis Weighting", groups: [{ group: "Emphasis", keywords: ["double parentheses", "triple parentheses", "negative prompt tag", "square brackets"] }]},
                { name: "Safe Prompting Tips", groups: [{ group: "Safety", keywords: ["use synonym translator", "focus on body positive terms", "avoid explicit terms"] }]},
                { name: "AI Readability", groups: [{ group: "Readability", keywords: ["concise prompt", "keyword clustering", "ordered flow (head-to-toe)"] }]}
            ]
        },
        // 16. Composition & Aesthetics (NEW ART DIRECTION CATEGORY)
        {
            category: "Composition & Aesthetics",
            description: "High-level artistic controls for framing, color, lighting, and style.",
            order: 16.0,
            subcategories: [
                {
                    name: "Composition Techniques",
                    groups: [
                        { group: "Framing & Layout", keywords: ["close-up", "wide shot", "asymmetrical", "rule of thirds", "golden ratio composition", "negative space emphasis"] },
                        { group: "Guidance", keywords: ["Specify the composition style to influence the layout of your image.", "Example Prompt: Create a close-up of a flower with dew drops."] }
                    ]
                },
                {
                    name: "Color Schemes",
                    groups: [
                        { group: "Palette Control", keywords: ["pastel colors", "monochrome", "contrasting colors", "analogous palette", "complementary scheme", "muted colors"] },
                        { group: "Guidance", keywords: ["Indicate a color palette to set the tone of your image.", "Example Prompt: Illustrate a tranquil landscape in pastel colors."] }
                    ]
                },
                {
                    name: "Lighting Techniques",
                    groups: [
                        { group: "Lighting Style", keywords: ["natural light", "soft lighting", "backlit", "rim lighting", "studio lighting (hard)", "cinematic lighting"] },
                        { group: "Guidance", keywords: ["Specify the type of lighting to enhance the atmosphere.", "Example Prompt: Generate an image of a cozy room with soft lighting."] }
                    ]
                },
                {
                    name: "Perspective and Viewpoint",
                    groups: [
                        { group: "Camera Angle", keywords: ["bird's-eye view", "eye-level", "worm's-eye view", "low angle", "high angle", "Dutch angle"] },
                        { group: "Guidance", keywords: ["Indicate the perspective to influence how the scene is perceived.", "Example Prompt: Create a bird's-eye view of a busy market."] }
                    ]
                },
                {
                    name: "Stylistic Choices",
                    groups: [
                        { group: "Art Style", keywords: ["impressionist", "surrealist", "pop art", "photorealism", "watercolor sketch", "cyberpunk aesthetic"] },
                        { group: "Guidance", keywords: ["Specify an art style to guide the visual interpretation.", "Example Prompt: Illustrate a dream-like landscape in a surrealist style."] }
                    ]
                },
                {
                    name: "Contextual Elements",
                    groups: [
                        { group: "Setting & Narrative", keywords: ["bustling city", "tranquil forest", "joyful moment", "dramatic storm", "urban street view", "historical palace interior"] },
                        { group: "Guidance", keywords: ["Include contextual details to enrich the narrative.", "Example Prompt: Generate a moment of joy between a child and a dog in a park."] }
                    ]
                },
            ]
        },
        // 20. Proportional Relationships & Mathematical Ratios
        {
            category: "Proportional Relationships & Ratios",
            description: "Controlling the mathematical and aesthetic scaling of the character's features.",
            order: 20.0,
            subcategories: [
                { name: "Golden Ratio Applications", groups: [{ group: "Ratio Controls", keywords: ["golden ratio (face)", "golden ratio (body segments)", "facial thirds defined", "body segment proportionality"] }] },
                { name: "Anatomical Measurement Systems", groups: [{ group: "Scale Systems", keywords: ["head-to-body ratio: 1:8", "limb proportionality", "classic human proportions"] }] },
                { name: "Symmetry vs. Asymmetry Controls", groups: [{ group: "Symmetry Modifiers", keywords: ["perfect symmetry", "subtle asymmetry (face)", "dramatic asymmetry (body)", "scale relationships defined"] }] },
                { name: "Comparative Scaling System (Concept)", groups: [{ group: "Scale Reference", keywords: ["relative size comparisons", "percentage-based sizing (50% larger)", "reference object scaling", "shoulder-to-hip ratio: 1.3:1"] }] }
            ]
        },
        // 21. Tutorial Mode / Guided Experience
        {
            category: "Tutorial Mode / Guided Experience",
            description: "Interactive tools and guides for learning to build powerful prompts.",
            order: 21.0,
            subcategories: [
                { name: "Guidance & Progress", groups: [
                    { group: "Learning Tools", keywords: ["Step-by-step wizard", "Interactive tooltips enabled", "Try this example buttons"] },
                    { group: "Progress & Mastery", keywords: ["Progress tracker (Beginner)", "Progress tracker (Intermediate)", "Progress tracker (Advanced)", "Achievement badges unlocked", "Master a category progress"] }
                ]}
            ]
        },
        // 22. Prompt Analyzer & Optimizer
        {
            category: "Prompt Analyzer & Optimizer",
            description: "Tools for reviewing and perfecting existing prompts.",
            order: 22.0,
            subcategories: [
                { name: "Analysis Tools", groups: [
                    { group: "Conflict Detection", keywords: ["Paste prompt for breakdown", "Conflict detector (finds contradictions)", "Redundancy remover"] },
                    { group: "Optimization Metrics", keywords: ["Complexity scorer", "Suggestions for improvement", "A/B testing tracker", "Version History & Iterations"] }
                ]}
            ]
        }
    ];

    // --- Utility Data (Kept Separate for Panels) ---

    const presetsData = [
        { name: "Runway Model", keywords: ["ectomorph", "long legs", "slender waist", "sharp jawline", "haute couture", "photorealistic", "soft studio lighting"] },
        { name: "Fantasy Warrior", keywords: ["mesomorph", "muscular arms", "broad shoulders", "plate armor", "dramatic shadows", "dynamic pose", "scars"] },
        { name: "Vintage Muse", keywords: ["hourglass figure", "full lips", "soft feminine features", "1950s fashion", "rosy cheeks", "wavy hair", "soft studio lighting"] },
        { name: "Sci-Fi Android", keywords: ["defined abs", "metallic skin", "androgynous", "cyberpunk aesthetic", "neon glow", "sharp focus", "blue eyes"] },
        { name: "Athletic Influencer", keywords: ["mesomorph", "toned legs", "six pack", "athletic build", "smooth skin", "gym wear", "high contrast"] },
        { name: "Custom Archetypes", keywords: ["add your own keywords here", "start with 3-5 keywords", "always use body type first"] },
    ];

    const explicitTermSynonyms = {
        "sex": ["sensual", "intimate", "passionate", "affectionate"],
        "breast": ["bust", "cleavage", "chest", "top half"],
        "nude": ["bare", "exposed", "topless", "revealing outfit"],
        "butt": ["glutes", "behind", "hips", "curvy lower body"],
        "vagina": ["female form", "pelvis area", "lower body"],
        "penis": ["male anatomy", "waist area", "midsection"],
        "genitalia": ["private areas", "pelvis area", "lower body"],
        "cunt": ["female genitalia", "vulva", "pelvic region", "lower body"],
        "pussy": ["female form", "pelvis area", "lower body"],
        "dick": ["male anatomy", "phallus", "male member", "waist area", "midsection"],
        "cock": ["male anatomy", "waist area", "midsection"],
        "boob": ["bust", "cleavage", "chest", "top half"],
        "fat": ["thick", "full-figured", "robust", "rounded", "ample", "plump"], 
        "big": ["ample", "voluminous", "substantial", "broad", "generous"], 
        "small": ["petite", "slight", "compact", "delicate"], 
        "skinny": ["slender", "slim", "lean", "fine-boned"], 
        "bald": ["shaved head", "clean scalp", "close crop"], 
        "ugly": ["distinctive", "characterful", "unique"], 
        "old": ["mature", "experienced", "seasoned", "aged"], 
        "young": ["youthful", "fresh-faced", "adolescent"], 
        "gross": ["rugged", "textured", "weathered"], 
        "short": ["compact", "petite", "short-statured"], 
        "tall": ["long-limbed", "elongated", "high-statured"], 
        "chubby": ["soft", "rounded", "plump"], 
        "thin": ["slim", "svelte", "lean"], 
        "average": ["proportional", "balanced", "natural build"],
        "bitch": ["challenging woman", "fierce individual", "assertive character", "strong-willed personality"],
        "hoe": ["provocatively dressed", "suggestive attire", "casual encounter", "free-spirited"],
        "slut": ["sensually posed", "revealing wardrobe", "provocative figure", "immodest apparel"],
        "whore": ["commercial sex worker", "street character", "suggestive profession", "transactional relationship"]
    };

    const ratioKeywordsData = {
        "Glutes": "glutes", "Thighs": "thighs", "Hips": "hips", "Waist": "waist", 
        "Breasts": "bust", "Shoulders": "shoulders", "Arms": "arms", "Legs": "legs", 
        "Feet": "feet", "Eyes": "eyes", "Nose": "nose", "Lips": "lips", 
        "Ears": "ears", "Nostrils": "nostrils", "Jawline": "jawline", "Chin": "chin", 
        "Neck": "neck"
    };
    
    // Initial ratio state (Ratio Scaling Panel)
    const ratioParts = {};
    Object.values(ratioKeywordsData).forEach(part => ratioParts[part] = 1.0);


    const smartTooltips = {
        "ectomorph": "Hint: Focus on slender, long, and elegant poses to accentuate the silhouette.",
        "mesomorph": "Hint: Use action poses and words like 'muscular' or 'toned' for best results.",
        "endomorph": "Hint: Use words like 'curvy' or 'voluptuous' to guide the AI and ensure correct rendering.",
        "volumetric lighting": "Aesthetic Cue: This creates dramatic shafts of light, enhancing cinematic feel.",
        "sharp jawline": "Prompt Tip: Add 'chiseled' or 'defined' for maximum impact.",
        "large bust": "Prompt Tip: Consider adding 'natural lift' for a more realistic result.",
        "low angle": "Aesthetic Cue: Use to emphasize height, power, and dominance.",
        "full body shot": "Prompt Tip: Ensures the AI renders the character head-to-toe and applies all body descriptors.",
    };

    // --- CORE JAVASCRIPT LOGIC (CODE MAINTAINABILITY) ---

    // 1. DOM Element Constants
    const glossaryContainer = document.getElementById('glossary-container');
    const keywordSearch = document.getElementById('keyword-search');
    const promptOutput = document.getElementById('prompt-output');
    const copyButton = document.getElementById('copy-button');
    const clearButton = document.getElementById('clear-button');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const somatotypeButtons = document.querySelectorAll('.body-type-button');
    const indexList = document.getElementById('floating-index');
    const presetsPanel = document.getElementById('presets-panel');
    const ratioPanel = document.getElementById('ratio-panel');
    const charCounter = document.getElementById('char-counter');
    const tokenEstimator = document.getElementById('token-estimator');


    // 2. State Variables
    let selectedKeywords = new Set();
    let selectedSomatotype = '';


    // 3. Initialization: Map keywords to their sorting order (Performance)
    const keywordOrderMap = new Map();
    function initializeKeywordMap() {
        glossaryData.sort((a, b) => a.order - b.order).forEach(category => {
            category.subcategories.forEach(sub => {
                const groups = sub.groups || [{ keywords: sub.keywords }];
                groups.forEach(group => { 
                    group.keywords.forEach(keyword => {
                        keywordOrderMap.set(keyword, category.order);
                    });
                });
            });
        });
    }

    // 4. Core Prompt Formatting Logic
    function formatPrompt() {
        const keywordsArray = Array.from(selectedKeywords);
        
        // Sorting logic (Smart Prompt Formula)
        const sortedKeywords = keywordsArray.sort((a, b) => {
            const orderA = keywordOrderMap.get(a) || Infinity;
            const orderB = keywordOrderMap.get(b) || Infinity;
            if (orderA !== orderB) {
                return orderA - orderB;
            }
            return a.localeCompare(b);
        });

        // Apply Ratios and Emphasis Syntax (Output Generation)
        const finalParts = [];
        const ratioKeywords = Object.keys(ratioKeywordsData).map(key => ratioKeywordsData[key]);

        if (selectedSomatotype) {
            finalParts.push(selectedSomatotype);
        }

        sortedKeywords.forEach(keyword => {
            let term = keyword;
            let ratioValue = 1.0;

            // Simple check for Ratio Application (Matching keyword to ratioPart key)
            const baseKeyword = keyword.toLowerCase().replace(/\s/g, '');
            const match = ratioKeywords.find(key => baseKeyword.includes(key));
            
            if (match && ratioParts[match] !== 1.0) {
                ratioValue = ratioParts[match];
                term = `(${keyword}:${ratioValue.toFixed(1)})`;
            } else if (keywordOrderMap.get(keyword) >= 14.0) {
                term = `[${keyword}]`;
            }

            if (keyword !== selectedSomatotype) {
                finalParts.push(term);
            }
        });

        const finalPrompt = finalParts.join(', ');
        promptOutput.value = finalPrompt;

        // Update Character/Token Counters
        charCounter.textContent = `Characters: ${finalPrompt.length}`;
        tokenEstimator.textContent = `Estimated Tokens: ${Math.ceil(finalPrompt.length / 4)}`; // Rough estimate
    }

    // 5. Utility Functions (Ratio Panel)
    function renderRatioPanel() {
        ratioPanel.innerHTML = '';
        const ratioKeys = Object.keys(ratioKeywordsData);
        const ratioValues = Object.values(ratioKeywordsData);

        ratioKeys.forEach((name, index) => {
            const part = ratioValues[index];
            const ratioBox = document.createElement('div');
            ratioBox.className = 'bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-center border border-gray-300 dark:border-gray-600';
            ratioBox.innerHTML = `
                <h4 class="font-bold text-gray-800 dark:text-gray-100 text-sm mb-1">${name}</h4>
                <div class="text-md font-mono text-blue-600 dark:text-blue-300 mb-2">
                    <span id="${part}Ratio">${ratioParts[part].toFixed(1)}</span>
                </div>
                <div class="flex justify-center space-x-1">
                    <button onclick="adjustRatio('${part}', 0.1)" class="py-1 px-2 bg-blue-500 text-white text-xs rounded-md hover:bg-blue-600 transition-colors" aria-label="Increase ${name} ratio by 0.1" tabindex="0">+</button>
                    <button onclick="adjustRatio('${part}', -0.1)" class="py-1 px-2 bg-red-500 text-white text-xs rounded-md hover:bg-red-600 transition-colors" aria-label="Decrease ${name} ratio by 0.1" tabindex="0">-</button>
                </div>
            `;
            ratioPanel.appendChild(ratioBox);
        });
    }

    function adjustRatio(part, delta) {
        ratioParts[part] = Math.max(0.1, +(ratioParts[part] + delta).toFixed(1));
        document.getElementById(part + 'Ratio').innerText = ratioParts[part].toFixed(1);
        formatPrompt();
    }
    window.adjustRatio = adjustRatio;

    // 6. UI Interaction Handlers
    somatotypeButtons.forEach(button => {
        button.addEventListener('click', () => {
            const keyword = button.dataset.keyword;
            somatotypeButtons.forEach(btn => {
                selectedKeywords.delete(btn.dataset.keyword);
                btn.classList.remove('selected', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
                btn.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                btn.setAttribute('aria-pressed', 'false');
            });
            selectedSomatotype = keyword;
            selectedKeywords.add(keyword);
            button.classList.add('selected', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
            button.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            button.setAttribute('aria-pressed', 'true');
            formatPrompt();
            renderGlossary(keywordSearch.value);
        });
    });

    // Function to apply keywords from an example prompt
    window.applyExamplePrompt = function(keywordsArray) {
        selectedKeywords.clear(); // Clear existing selections first
        keywordsArray.forEach(kw => {
            selectedKeywords.add(kw);
        });
        formatPrompt();
        renderGlossary(keywordSearch.value);
        window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to prompt area
    }


    function toggleCollapsible(id, button) {
        const content = document.getElementById(id);
        const isExpanded = button.getAttribute('aria-expanded') === 'true';
        button.setAttribute('aria-expanded', !isExpanded);
        document.getElementById(id).style.maxHeight = isExpanded ? '0' : '500px';
        document.getElementById(id).style.padding = isExpanded ? '0 4px' : '1rem';
        document.getElementById(id).style.border = isExpanded ? 'none' : '1px solid #d1d5db';
        document.getElementById(id).style.borderTop = 'none';

        document.getElementById(id.replace('-content', '-icon')).textContent = isExpanded ? '+' : '−';
    }


    function renderPresetsPanel() {
        presetsPanel.innerHTML = '';
        presetsData.forEach(preset => {
            const button = document.createElement('button');
            button.className = 'py-3 px-4 rounded-lg font-semibold bg-green-500 text-white hover:bg-green-600 transition-colors';
            button.textContent = preset.name;
            button.addEventListener('click', () => {
                preset.keywords.forEach(kw => {
                    selectedKeywords.add(kw);
                });
                formatPrompt();
                renderGlossary(keywordSearch.value);
                // Feature: User Feedback (Success Message)
                const originalText = button.textContent;
                button.textContent = `Applied ${preset.name}!`;
                setTimeout(() => { button.textContent = originalText; }, 1500);
            });
            presetsPanel.appendChild(button);
        });
    }

    darkModeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        const isDark = document.documentElement.classList.contains('dark');
        darkModeToggle.textContent = isDark ? 'Toggle Light Mode' : 'Toggle Dark Mode';
    });

    // Feature: Smooth Scrolling Index (A11y/UX)
    function renderIndex() {
        const indexLinks = document.createElement('div');
        glossaryData.forEach(category => {
            const categoryId = category.category.replace(/[^a-zA-Z0-9]/g, '-');
            
            const link = document.createElement('a');
            link.href = `#${categoryId}`;
            link.textContent = category.category;
            link.className = 'block py-1 px-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-gray-700 rounded transition-colors truncate cursor-pointer';
            
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetElement = document.getElementById(categoryId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            indexLinks.appendChild(link);
        });
        indexList.appendChild(indexLinks);
    }
    
    // For SVG Mapper to work
    window.smoothScrollTo = function(id) {
        const targetElement = document.getElementById(id);
        if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }


    function createKeywordButton(keyword) {
        const button = document.createElement('button');
        button.textContent = keyword;
        button.className = `keyword-button p-3 rounded-lg border-2 text-sm font-medium shadow-sm truncate w-full text-center tooltip-container`;
        button.setAttribute('role', 'checkbox');
        button.setAttribute('aria-checked', selectedKeywords.has(keyword) ? 'true' : 'false');
        
        const tooltipText = smartTooltips[keyword] || `Keyword: ${keyword}. Click to add to prompt.`;
        button.innerHTML = `${keyword}<span class="tooltip-text">${tooltipText}</span>`;

        if (selectedKeywords.has(keyword)) {
            button.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-700', 'hover:bg-blue-700');
            button.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200', 'border-gray-300', 'dark:border-gray-600');
        } else {
            button.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200', 'border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-200', 'dark:hover:bg-gray-600');
            button.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-700', 'hover:bg-blue-700');
        }

        button.addEventListener('click', () => {
            if (selectedKeywords.has(keyword)) {
                selectedKeywords.delete(keyword);
            } else {
                selectedKeywords.add(keyword);
            }
            formatPrompt();
            renderGlossary(keywordSearch.value);
        });
        return button;
    }

    // 7. Main Rendering Function
    function renderGlossary(filter = '') {
        glossaryContainer.innerHTML = '';
        const filterText = filter.trim().toLowerCase();

        // Explicit Term Check (Synonym Translator Box)
        const explicitMatch = Object.keys(explicitTermSynonyms).find(term => filterText !== '' && filterText.includes(term.toLowerCase()));
        if (explicitMatch) {
            const safeWords = explicitTermSynonyms[explicitMatch];
            const resultsSection = document.createElement('div');
            resultsSection.className = 'p-6 bg-yellow-100 dark:bg-yellow-900 rounded-xl shadow-md border-2 border-yellow-400 dark:border-yellow-700';
            resultsSection.innerHTML = `
                <h2 class="text-2xl font-bold mb-3 text-yellow-800 dark:text-yellow-200">🚨 Safety Filter: Forbidden Term Detected</h2>
                <p class="text-yellow-700 dark:text-yellow-300 mb-4">The term **'${explicitMatch}'** may violate AI safety filters. Please use one of these approved, safe alternatives:</p>
            `;
            const keywordsList = document.createElement('div');
            keywordsList.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-6 gap-3';
            
            safeWords.forEach(keyword => {
                keywordsList.appendChild(createKeywordButton(keyword));
            });
            resultsSection.appendChild(keywordsList);
            glossaryContainer.appendChild(resultsSection);
            return;
        }

        // Search Results View
        if (filterText !== '') {
            const allKeywords = Array.from(keywordOrderMap.keys());
            const filteredKeywords = allKeywords.filter(kw => kw.toLowerCase().includes(filterText));

            const resultsSection = document.createElement('div');
            resultsSection.className = 'bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md';
            resultsSection.innerHTML = `<h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Search Results for "${filter}" (${filteredKeywords.length})</h2>`;
            
            const keywordsList = document.createElement('div');
            keywordsList.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-6 gap-3';
            filteredKeywords.forEach(keyword => {
                keywordsList.appendChild(createKeywordButton(keyword));
            });
            resultsSection.appendChild(keywordsList);
            glossaryContainer.appendChild(resultsSection);

        } else {
            // Nested Glossary Rendering (Full Glossary View)
            glossaryData.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.id = category.category.replace(/[^a-zA-Z0-9]/g, '-');
                categoryElement.className = 'bg-white dark:bg-gray-800 rounded-xl p-6 shadow-xl category-card border border-gray-200 dark:border-gray-700';
                categoryElement.innerHTML = `
                    <h2 class="text-3xl font-extrabold mb-2 text-blue-600 dark:text-blue-400">${category.category}</h2>
                    <p class="text-gray-600 dark:text-gray-400 mb-6 text-base">${category.description}</p>
                `;

                const subcategoryWrapper = document.createElement('div');
                subcategoryWrapper.className = 'space-y-6';

                category.subcategories.forEach(sub => {
                    const subElement = document.createElement('div');
                    subElement.className = 'p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700';
                    const cleanSubName = sub.name.replace(/^[0-9]\.?[A-Z][0-9]*\.?\s/, '');
                    subElement.innerHTML = `<h3 class="text-xl font-semibold mb-3 text-gray-800 dark:text-gray-200">${cleanSubName}</h3>`;
                    
                    const groupWrapper = document.createElement('div');
                    groupWrapper.className = 'space-y-4';

                    const groupsToRender = sub.groups || [{ group: 'General Descriptors', keywords: sub.keywords }];

                    groupsToRender.forEach(group => {
                        const groupElement = document.createElement('div');
                        groupElement.className = 'p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow-sm';
                        const cleanGroupName = group.group.replace(/^[0-9]\.?[A-Z][0-9]*\.?\s/, '');
                        groupElement.innerHTML = `<h4 class="text-lg font-medium mb-3 text-green-700 dark:text-green-400">${cleanGroupName}</h4>`;

                        const keywordsList = document.createElement('div');
                        keywordsList.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3';
                        
                        group.keywords.forEach(keyword => {
                            keywordsList.appendChild(createKeywordButton(keyword));
                        });
                        
                        groupElement.appendChild(keywordsList);
                        groupWrapper.appendChild(groupElement);
                    });

                    subElement.appendChild(groupWrapper);
                    subcategoryWrapper.appendChild(subElement);
                });

                categoryElement.appendChild(subcategoryWrapper);
                glossaryContainer.appendChild(categoryElement);
            });
        }
    }

    // 8. Event Listeners and Initialization
    keywordSearch.addEventListener('input', formatPrompt);
    keywordSearch.addEventListener('input', (e) => {
        renderGlossary(e.target.value);
    });

    copyButton.addEventListener('click', () => {
        if (promptOutput.value.length > 0) {
            promptOutput.select();
            document.execCommand('copy');
            // Feature: User Feedback (Success Message)
            const originalText = copyButton.textContent;
            copyButton.textContent = 'Prompt Copied!';
            copyButton.classList.add('bg-green-600', 'hover:bg-green-700');
            copyButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            setTimeout(() => {
                copyButton.textContent = originalText;
                copyButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                copyButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
            } , 1500);
        }
    });

    clearButton.addEventListener('click', () => {
        selectedKeywords.clear();
        selectedSomatotype = '';
        somatotypeButtons.forEach(btn => {
            btn.classList.remove('selected', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
            btn.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            btn.setAttribute('aria-pressed', 'false');
        });
        Object.keys(ratioParts).forEach(key => ratioParts[key] = 1.0);
        renderRatioPanel();
        
        formatPrompt();
        renderGlossary(keywordSearch.value);

        // Feature: User Feedback (Success Message)
        const originalText = clearButton.textContent;
        clearButton.textContent = 'Cleared!';
        setTimeout(() => { clearButton.textContent = originalText; }, 1000);
    });

    // Initial renders on page load
    document.addEventListener('DOMContentLoaded', () => {
        initializeKeywordMap(); // Initialize map once
        renderRatioPanel();
        renderPresetsPanel();
        renderGlossary();
        renderIndex();
        formatPrompt(); // Initial counter update
    });
</script>

</body>
</html>
