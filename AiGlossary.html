<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate AI Character Glossary | Final Master Build</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Custom Scrollbar for sleek look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 4px; }
        ::-webkit-scrollbar-track { background: #f3f4f6; }
        .dark ::-webkit-scrollbar-thumb { background-color: #4b5563; }
        .dark ::-webkit-scrollbar-track { background: #1f2937; }

        /* Floating Index Styling */
        .floating-index {
            position: fixed;
            top: 100px;
            left: 5%;
            width: 250px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            z-index: 10;
        }

        /* Keyword Button Styling */
        .keyword-button {
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            /* Added animation on hover as requested */
            transform: scale(1);
        }
        .keyword-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .selected {
            background-color: #1e40af; /* Blue-800 */
            color: white;
            border-color: #1e3a8a;
        }

        /* Tooltip Styling */
        .tooltip-container {
            position: relative;
        }
        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 50;
            bottom: 125%; /* Position above the button */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Dark Mode Overrides */
        .dark body {
            background-color: #111827; /* Gray-900 */
            color: #f3f4f6;
        }
        .dark .bg-white { background-color: #1f2937 !important; } /* Gray-800 */
        .dark .text-gray-800 { color: #f3f4f6 !important; }
        .dark .text-gray-600 { color: #d1d5db !important; }
        .dark .bg-gray-100 { background-color: #374151 !important; } /* Gray-700 */
        .dark .border-gray-300 { border-color: #4b5563 !important; }
        .dark .category-card { background-color: #1f2937 !important; }
    </style>
</head>
<body class="bg-gray-50 transition-colors duration-500">

    <div id="floating-index" class="floating-index hidden lg:block bg-white dark:bg-gray-800 p-4 rounded-xl shadow-xl space-y-2 border border-gray-200 dark:border-gray-700">
        <h3 class="text-xl font-bold mb-3 border-b pb-2 text-gray-800 dark:text-gray-200">Glossary Index</h3>
        <button id="darkModeToggle" class="w-full py-2 px-3 text-sm rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
            Toggle Dark Mode
        </button>
        </div>

    <div class="max-w-7xl mx-auto p-4 lg:pl-80">
        <header class="text-center py-8 mb-8 bg-blue-700 rounded-xl shadow-2xl text-white">
            <h1 class="text-4xl font-extrabold tracking-tight">Ultimate AI Character Glossary</h1>
            <p class="mt-2 text-blue-200">Head-to-Toe Character Building & Smart Prompting</p>
        </header>

        <section class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-4 text-gray-800 dark:text-gray-200">Your Custom Prompt (Real-Time Builder)</h2>
            <textarea id="prompt-output" rows="4" class="w-full p-4 mb-4 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 resize-none" placeholder="Select keywords below to build your prompt, or type custom ones..."></textarea>
            
            <div class="flex justify-between items-center text-sm font-medium text-gray-600 dark:text-gray-400 mb-4">
                <span id="char-counter">Characters: 0</span>
                <span id="token-estimator">Estimated Tokens: 0</span>
            </div>

            <div class="flex flex-wrap gap-4">
                <button id="copy-button" class="flex-1 min-w-[150px] py-3 px-6 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-colors">
                    Copy Prompt
                </button>
                <button id="clear-button" class="flex-1 min-w-[150px] py-3 px-6 rounded-lg font-semibold bg-red-500 text-white hover:bg-red-600 transition-colors">
                    Clear Prompt
                </button>
            </div>
        </section>

        <section class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-2 text-gray-800 dark:text-gray-200">Synonym Translator Box (Smart Search)</h2>
            <input type="text" id="keyword-search" class="w-full p-4 border border-gray-300 rounded-lg text-lg focus:ring-yellow-500 focus:border-yellow-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Search a flagged word to find safe alternatives (Fuzzy Matching enabled)..."/>
        </section>

        <section id="utility-panel" class="mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg space-y-8">
            <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200 border-b pb-2">Utility Panels</h2>

            <div>
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Persona Presets</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Click a preset to instantly add a foundational set of keywords.</p>
                <div id="presets-panel" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    </div>
            </div>

            <div>
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Proportion Visualizer & Ratio Scaling</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Adjust values to emphasize features. Value is injected as (keyword:ratio). **(Default: 1.0)**</p>
                <div id="ratio-panel" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-6">
                    </div>
            </div>
            
            <div>
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Body Type Selector (Somatotype)</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Select the foundational body shape (Mutually Exclusive).</p>
                <div id="somatotype-panel" class="grid grid-cols-3 gap-4">
                    <button data-keyword="ectomorph" class="body-type-button py-3 px-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-blue-200 dark:hover:bg-blue-900 transition-colors">Ectomorph</button>
                    <button data-keyword="mesomorph" class="body-type-button py-3 px-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-blue-200 dark:hover:bg-blue-900 transition-colors">Mesomorph</button>
                    <button data-keyword="endomorph" class="body-type-button py-3 px-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-blue-200 dark:hover:bg-blue-900 transition-colors">Endomorph</button>
                </div>
            </div>
            
            <div class="border-t pt-8">
                <h3 class="text-2xl font-semibold mb-3 text-blue-600 dark:text-blue-400">Visual Body Mapper (Interactive SVG Concept)</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Clicking the silhouette sections will jump to the corresponding area in the glossary below. (Currently: Prototype SVG)</p>
                <div id="svg-mapper-placeholder" class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg border-2 border-dashed border-gray-400 dark:border-gray-600 flex justify-center items-center h-64">
                    <svg width="100" height="180" viewBox="0 0 100 180" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="40" y="0" width="20" height="20" rx="10" fill="#3B82F6" class="hover:fill-red-500 cursor-pointer" onclick="smoothScrollTo('Hair-Styling')"/>
                        <rect x="30" y="25" width="40" height="15" fill="#3B82F6" class="hover:fill-red-500 cursor-pointer" onclick="smoothScrollTo('Facial-Features')"/>
                        <rect x="35" y="45" width="30" height="40" fill="#3B82F6" class="hover:fill-red-500 cursor-pointer" onclick="smoothScrollTo('Female-Anatomy')"/>
                        <rect x="35" y="90" width="30" height="15" fill="#3B82F6" class="hover:fill-red-500 cursor-pointer" onclick="smoothScrollTo('Upper-Body')"/>
                        <rect x="35" y="110" width="30" height="70" fill="#3B82F6" class="hover:fill-red-500 cursor-pointer" onclick="smoothScrollTo('Lower-Body')"/>
                    </svg>
                </div>
            </div>

        </section>

        <section id="glossary-container" class="space-y-10">
            </section>
    </div>

<script>
    // --- Data: FULLY CONSOLIDATED MASTER DATA (All past chats integrated) ---

    const glossaryData = [
        // 1. Hair & Styling (Order 1.0)
        { 
            category: "Hair & Styling", 
            description: "Detailed characteristics for hair and head aesthetics.", 
            order: 1.0, 
            subcategories: [
                { name: "Hair Texture", groups: [{ group: "Texture", keywords: ["fine straight", "medium straight", "coarse straight", "silky straight", "soft waves", "loose waves", "beach waves", "tousled waves", "textured waves", "ringlets", "spiral curls", "bouncy curls", "soft curls", "kinky curls", "voluminous curls", "perm curls", "twist-out curls", "braid-out curls", "TWA coils", "afro coils", "mini coils", "dense coils", "springy coils", "coily twists", "natural shrinkage coils", "defined curls", "loose curls"] }]},
                { name: "Hair Length", groups: [{ group: "Length", keywords: ["pixie", "ear-length", "chin-length", "jaw-length", "short bob", "bob", "lob", "shoulder-length", "collarbone-length", "mid-back", "waist-length", "hip-length", "thigh-length", "floor-length"] }]},
                { name: "Hair Thickness", groups: [{ group: "Thickness", keywords: ["micro", "thin", "fine", "medium", "thick", "dense", "full", "heavy", "jumbo", "chunky", "layered", "multi-layered"] }]},
                { name: "Hair Color", groups: [{ group: "Color", keywords: ["black", "natural black", "dark brown", "medium brown", "light brown", "chestnut", "auburn", "mahogany", "red", "golden brown", "blonde", "platinum blonde", "ash blonde", "honey blonde", "strawberry blonde", "balayage brown-blonde", "ombré", "dip-dye", "highlights", "lowlights", "peekaboo highlights", "two-tone", "bronde", "pastel pink", "lavender", "baby blue", "mint green", "neon streaks", "rainbow", "silver", "grey highlights", "ombre pastel", "bronze highlights"] }]},
                { name: "Hair Parting", groups: [{ group: "Parting", keywords: ["center part", "deep center part", "side part left", "side part right", "deep side part", "middle part", "zig-zag part", "C-part", "invisible part", "curved part", "hard part", "soft part", "boxed part", "triangle parts", "diamond parts", "star part", "peekaboo part"] }]},
                { name: "Bangs & Hairline", groups: [{ group: "Bangs/Hairline", keywords: ["no bangs", "straight fringe", "curtain bangs", "swooped bangs", "asymmetrical bangs", "feathered bangs", "micro bangs", "side-swept bangs", "pre-plucked hairline", "natural hairline", "baby hairs laid", "subtle baby hairs", "dramatic baby hairs", "swooped edges", "laid edges"] }]},
                { name: "Hair Accessories", groups: [{ group: "Accessories", keywords: ["hair clips", "barrettes", "pins", "ribbons", "scrunchies", "elastic bands", "beads", "threads", "hair cuffs", "hair rings", "decorative pins", "flowers", "headbands", "scarves", "wraps", "decorative combs", "hair jewelry", "tinsel strands", "feathers"] }]},
                { name: "Hair Patterns & Finishes", groups: [{ group: "Patterns/Finishes", keywords: ["curl ends", "feathered tips", "soft waves", "sleek finish", "tousled finish", "spiral curls", "highlighted tips", "ombre tips", "spray stencil pattern", "painted streaks", "dip-dye tips", "dipped ends", "crimped texture", "pressed sleek", "matte finish", "glossy finish"] }]},
                { name: "Hair Movement", groups: [{ group: "Movement", keywords: ["flowing hair", "windblown", "messy", "perfectly styled"] }]},
                { name: "Hairline Types", groups: [{ group: "Hairline Types", keywords: ["low hairline", "high hairline", "widow's peak", "straight hairline"] }]}
            ]
        },
        // 2. Facial Features (Order 2.0)
        { 
            category: "Facial Features", 
            description: "Keywords for detailing the face and neck.", 
            order: 2.0, 
            subcategories: [
                { name: "Eyes", groups: [{ group: "Shape & Color", keywords: ["blue eyes", "green eyes", "almond shaped eyes", "piercing gaze", "hooded eyes", "doe eyes", "monolid", "double eyelid", 'deep-set eyes', 'round eyes (large)', 'narrow eyes', 'wide-set eyes', 'youthful gaze', 'aged eyes', 'Eye spacing', 'Iris size', 'Pupil dilation', 'Eyelid shape (monolid)', 'Eyelid shape (double lid)', 'Eyelid shape (hooded)'] }]},
                { name: "Nose", groups: [{ group: "Nose Shape", keywords: ["small nose", "roman nose", "button nose", "aquiline nose", "wide nose", 'small bridge nose', 'slender bridge', 'hooked nose', 'defined nose tip', 'Nose bridge height', 'Nostril flare'] }]},
                { name: "Lips", groups: [{ group: "Mouth/Lips", keywords: ["full lips", "thin lips", "pouty", "sharp smile", "smirking", "cupid's bow", 'Lip cupid\'s bow definition', 'Lip corner position (upturned)', 'Lip corner position (neutral)', 'Lip corner position (downturned)'] }]},
                { name: "Ears", groups: [{ group: "Ear Shape", keywords: ["small ears", "large ears", "piercings", "pointy ears (fantasy)", "tapered ears"] }]},
                { name: "Nostrils", groups: [{ group: "Nostrils", keywords: ["flared nostrils", "narrow nostrils", "subtle nostrils"] }]},
                { name: "Jawline", groups: [{ group: "Jawline", keywords: ["sharp jawline", "soft jawline", "chiseled jaw", "square jaw", "v-shaped jaw", 'rounded jaw', 'angular features', 'defined mandible'] }]},
                { name: "Chin", groups: [{ group: "Chin", keywords: ["strong chin", "receding chin", "dimpled chin", "pointed chin", "square chin", 'prominent chin', 'cleft chin'] }]},
                { name: "Cheeks", groups: [{ group: "Cheeks", keywords: ["high cheekbones", "rosy cheeks", "sunken cheeks", "full cheeks", "chubby cheeks", 'prominent cheekbones', 'soft features', 'puffy face', 'gaunt face'] }]},
                { name: "Neck", groups: [{ group: "Neck", keywords: ["long neck", "thick neck", "slender neck", "adam's apple (male)", "defined collarbones", 'slim neck', 'graceful neck', 'delicate neck', 'toned neck'] }]},
                { name: "Micro-Features & Symmetry", groups: [
                    { group: "Forehead & Brow Ridge", keywords: ["prominent brow ridge", "sloping forehead", "flat forehead", "smooth temples"] },
                    { group: "Facial Symmetry", keywords: ["high symmetry face", "youthful symmetry", "aged symmetry", "asymmetrical face", "facial thirds defined", "Philtrum defined", "Facial Symmetry Modifiers"] }
                ]}
            ]
        },
        // 3. Female Anatomy (Order 3.0)
        { 
            category: "Female Anatomy", 
            description: "Detailed characteristics specific to the female form. (Gender-Neutral Compatible)", 
            order: 3.0, 
            subcategories: [
                // Breasts Size & Shape (FULLY POPULATED FROM PREVIOUS CHATS)
                { name: "Breasts (General Size)", groups: [
                    { group: "Small Breasts", keywords: ["petite bust", "delicate bust", "subtle bust", "slight bust", "modest bust", "flat bust", "compact bust", "dainty bust", "narrow bust", "graceful bust", "fine bust", "light bust", "minimal bust", "slender bust", "petite chest", "delicate chest", "subtle chest", "flat chest", "compact chest", "dainty chest", "narrow chest", "graceful chest", "fine chest", "light chest", "minimal chest", "slender chest", "petite figure", "slight figure", "modest figure", "flat figure", "compact figure", "slender figure", "petite frame", "delicate frame", "narrow frame", "slender frame", "light frame"] },
                    { group: "Medium Breasts", keywords: ["balanced bust", "moderate bust", "average bust", "normal bust", "proportional bust", "natural bust", "rounded bust", "classic bust", "centered bust", "steady bust", "harmonious bust", "tasteful bust", "symmetrical bust", "refined bust", "aesthetic bust", "elegant bust", "balanced chest", "moderate chest", "average chest", "normal chest", "proportional chest", "rounded chest", "classic chest", "centered chest", "symmetrical chest", "natural silhouette", "refined silhouette", "harmonious figure", "balanced figure", "rounded figure", "classic figure", "centered figure", "natural figure"] },
                    { group: "Large Breasts", keywords: ["full bust", "ample chest", "voluptuous curve", "dramatic cleavage", "rounded fullness", "deep bustline", "enhanced projection", "abundant chest volume", "curvaceous bust", "generous bustline", "lifted full bust", "defined round chest", "mature bust fullness", "youthful bust abundance", "natural large bust shape", "symmetrical full bust", "dramatic proportion", "sculpted chest silhouette", "enhanced cleavage line", "deep chest shadow", "highlighted full bust contour", "firm large bust", "soft abundant chest", "natural generous projection", "heavy bustline", "rounded mature chest", "abundant bust symmetry", "lifted bust with fullness", "proportionate large bust", "highlighted bust curve", "dramatic chest profile", "deep rounded cleavage", "sculpted bust abundance", "elegant chest volume", "defined bust highlight", "symmetrical full projection", "enhanced lift with fullness", "graceful large bust contour", "mature round bust shape", "voluptuous symmetry", "natural chest abundance", "highlighted cleavage shadow", "abundant feminine bustline", "defined bust silhouette", "full contour lift", "dramatic chest symmetry", "elegant rounded profile", "highlighted feminine chest shape", "sculpted chest prominence", "natural bust roundness", "deep cleavage emphasis", "proportionate abundant bust", "symmetrical round fullness", "graceful bust dimension", "dramatic bust taper", "enhanced rounded projection", "highlighted chest lift", "abundant bust harmony", "curvaceous feminine chest profile", "elegant full bust balance", "natural large bust silhouette", "lifted bust projection", "highlighted full bust tone", "sculpted mature chest", "rounded bust with abundance", "proportionate heavy bust", "dramatic bust curve", "graceful projection outline", "abundant bust slope", "natural full bust highlight", "symmetrical bust shadow", "highlighted dramatic cleavage", "firm large projection", "enhanced contour bustline", "elegant curvaceous chest profile", "lifted abundant bustline", "refined bust shape fullness", "graceful large chest taper", "highlighted bust round profile", "voluptuous feminine contour", "mature bust abundance", "youthful large bust balance", "sculpted chest prominence line", "natural generous bust silhouette", "dramatic round chest balance", "highlighted cleavage prominence", "elegant bust symmetry", "proportionate chest roundness", "abundant bust projection harmony", "highlighted feminine bustline", "graceful large bust highlight", "full chest symmetry", "dramatic curvaceous profile", "natural enhanced bust lift"] }
                ]},
                { name: "Breast Shape", groups: [
                    { group: "Surgical Shapes", keywords: ["teardrop shape", "gummy bear shape", "round implant silhouette", "anatomical contour", "high profile projection", "low profile slope", "full upper pole", "natural taper", "wide base bust", "narrow base bust", "sloped teardrop", "projected roundness", "soft anatomical shape", "firm implant contour", "enhanced cleavage shape", "sculpted bust silhouette"] },
                    { group: "Natural Shapes", keywords: ["asymmetrical bust", "natural sag", "gentle slope", "full lower pole", "rounded natural contour", "soft bust shape", "mature bust silhouette", "youthful perkiness", "natural bust taper", "slightly uneven bustline", "organic bust form", "subtle natural projection"] }
                ]},
                { name: "Waist & Torso", groups: [
                    { group: "Waist Types", keywords: ["slim waist", "tapered torso", "hourglass waist", "athletic midsection", "soft curve", "defined waistline", "natural taper", "compact torso", "elongated torso", "balanced midsection", "narrow waist", "tiny waist", "cinched waist", "broad waist", "straight waist", "proportional waist", "long waist", "short waist"] },
                    { group: "Torso Build", keywords: ["slender torso", "broad torso", "curvy torso", "petite torso", "muscular torso", "streamlined torso", "full torso", "lean torso", "rounded torso", "sculpted torso", "toned torso", "soft torso", "firm torso", "supple torso", "compact torso"] }
                ]},
                { name: "Hips", groups: [
                    { group: "Hip Descriptors", keywords: ["narrow hips", "slim hips", "petite hips", "compact hips", "broad hips", "wide hips", "generous hips", "full hips", "ample hips", "expansive hips", "voluminous hips", "balanced hips", "average hips", "natural hips", "rounded hips", "curved hips", "heart-shaped hips", "pear-shaped hips", "diamond-shaped hips", "square hips", "boxy hips", "sculpted hips", "streamlined hips", "symmetric hips", "hip dips", "slight hip dips", "deep hip dips", "smooth hip line", "pelvic curve", "waist-to-hip curve", "athletic hips", "toned hips", "sculpted hips", "soft hips", "gentle hips", "feminine hips", "elegant hips", "youthful hips", "mature hips", "BBL hips", "enhanced hips", "natural BBL hips", "dramatic BBL hips", "graceful hips", "harmonious hips", "dramatic hips", "highlighted hips", "defined hips", "stylized hips"] }
                ]},
                { name: "Navel Types", groups: [
                    { group: "Navel Definition", keywords: ["innie navel", "outie navel", "T-shaped navel", "vertical navel", "horizontal navel", "subtle navel", "prominent navel"] }
                ]}
            ]
        },
        // 4. Male Anatomy (Order 4.0)
        { 
            category: "Male Anatomy", 
            description: "Detailed characteristics specific to the male form. (Gender-Neutral Compatible)", 
            order: 4.0, 
            subcategories: [
                { name: "Chest & Torso", groups: [
                    { group: "Chest Build", keywords: ["broad chest", "toned torso", "muscular build", "defined pecs", "flat chest", "sculpted upper body", "lean chest", "athletic torso", "full chest", "compact torso", "wide chest", "expansive chest", "generous chest", "ample chest", "barrel chest", "robust chest", "narrow chest", "slim chest", "petite chest", "slight chest", "delicate chest", "trim chest"] },
                    { group: "Torso Shape", keywords: ["rectangular torso", "square torso", "straight torso", "linear torso", "elongated torso", "slender torso", "V-shaped torso", "V-taper torso", "inverted triangle torso", "classic triangle torso", "hourglass torso (male build)", "rounded torso", "broad-shouldered torso", "narrow-shouldered torso"] }
                ]},
                { name: "Muscle Definition", groups: [
                    { group: "Muscle Types", keywords: ["lean muscle", "bulky muscle", "toned muscle", "vascular build", "sculpted physique", "defined abs", "broad shoulders", "cut arms", "tight core", "powerful frame", 'ripped physique', 'shredded definition', 'hyper-muscular', 'low body fat', 'extreme definition', 'bodybuilder physique', 'mass monster', 'aesthetic physique', 'thick muscle bellies', 'dense and hard muscle', 'crossfit build', 'calisthenics build', 'granite-like muscles', 'striated muscle tissue'] }
                ]},
                { name: "Abdomen Definition", groups: [
                    { group: "Core Definition", keywords: ["flat stomach", "toned stomach", "soft abdomen", "defined abs", "subtle abs", "sculpted core", "six-pack defined", "washboard abs", "smooth stomach", "rounded gut"] }
                ]},
                { name: "Male Arms", groups: [
                    { group: "Arm Descriptors", keywords: ["slim arms", "narrow arms", "lean arms", "slender arms", "delicate arms", "trim arms", "broad arms", "thick arms", "strong arms", "robust arms", "hefty arms", "sturdy arms", "bulky arms", "average arms", "balanced arms", "moderate arms", "proportional arms", "long arms", "short arms", "compact arms", "extended arms", "tapered arms", "rectangular arms", "angular arms", "V-taper arms", "flowing arms", "arched arms", "straight arms", "sculpted arms", "rounded arms", "toned arms", "defined arms", "muscular arms", "athletic arms", "fit arms", "powerful arms", "firm arms", "brawny arms", "hardened arms", "trained arms", "runner’s arms", "boxer’s arms", "bodybuilder arms", "martial artist arms", "swimmer’s arms", "model arms", "heroic arms", "classic arms", "elegant arms", "refined arms", "statuesque arms", "tailored arms", "fashion arms", "runway arms", "arm frame", "arm silhouette", "arm proportion", "arm outline", "smooth arms", "even arms", "toned surface arms", "defined surface arms", "refined arms", "angular arms", "soft-line arms"] }
                ]},
                { name: "Male Legs", groups: [
                    { group: "Leg Descriptors", keywords: ["slim legs", "slender legs", "lean legs", "narrow legs", "long legs", "short legs", "compact legs", "balanced legs", "broad legs", "thick legs", "sturdy legs", "muscular legs", "athletic legs", "powerful legs", "robust legs", "firm legs", "straight legs", "arched legs", "tapered legs", "rectangular legs", "rounded legs", "angular legs", "elongated legs", "curved legs", "runner’s legs", "sprinter’s legs", "swimmer’s legs", "soccer legs", "martial legs", "sculpted legs", "toned legs", "defined legs", "strong legs", "powerful legs", "solid legs", "brawny legs", "trained legs", "heroic legs", "firm legs", "model legs", "bodybuilder legs", "lean muscular legs", "dynamic legs", "runway legs", "tailored legs", "fitted legs", "statuesque legs", "aesthetic legs", "proportional legs", "fashion legs", "smooth legs", "even legs", "toned legs", "angular legs", "symmetrical legs", "refined legs", "classic legs"] }
                ]},
                { name: "Male Back & Shoulders", groups: [
                    { group: "Back & Shoulder Descriptors", keywords: ["broad shoulders", "wide shoulders", "expansive shoulders", "generous shoulders", "square shoulders", "narrow shoulders", "slim shoulders", "compact shoulders", "delicate shoulders", "balanced shoulders", "average shoulders", "angular shoulders", "rounded shoulders", "sloped shoulders", "straight shoulders", "classic V-shape shoulders", "inverted triangle shoulders", "athletic shoulders", "heroic shoulders", "regal shoulders", "sculpted shoulders", "toned shoulders", "defined shoulders", "strong shoulders", "muscular shoulders", "firm shoulders", "solid shoulders", "powerful shoulders", "fit shoulders", "statuesque shoulders", "tailored shoulders", "suit shoulders", "armor shoulders", "model shoulders", "runway shoulders", "fashion shoulders", "symmetrical shoulders", "proportional shoulders", "refined shoulders", "aesthetic shoulders", "broad back", "wide back", "expansive back", "generous back", "robust back", "narrow back", "slim back", "lean back", "compact back", "balanced back", "average back", "V-shaped back", "tapered back", "rectangular back", "elongated back", "straight back", "arched back", "rounded back", "angular back", "classic taper back", "dramatic taper back", "subtle taper back", "sculpted back", "toned back", "defined back", "muscular back", "athletic back", "firm back", "strong back", "heroic back", "powerful back", "statuesque back", "model back", "runner’s back", "swimmer’s back", "warrior’s back", "tailored back", "suit back", "fitted back", "runway back", "fashion back", "armor back", "classic back", "modern back", "aesthetic back", "smooth back", "symmetrical back", "refined back", "polished back", "structured back", "harmonious back"] }
                ]}
            ]
        },
        // 5. Upper Body (Order 5.0)
        { 
            category: "Upper Body", 
            description: "Features common to both sexes, focusing on arms and shoulders.", 
            order: 5.0, 
            subcategories: [
                { name: "Shoulders", groups: [{ group: "Shoulders", keywords: ["broad shoulders", "narrow shoulders", "sloping shoulders", "defined traps", 'rounded shoulders', 'sculpted shoulders', 'sloped shoulders', 'delicate shoulders', 'feminine shoulders', 'athletic shoulders', 'highlighted shoulders'] }]},
                { name: "Arms", groups: [{ group: "Arm Shape", keywords: ["muscular arms", "toned arms", "slim arms", "strong arms", "veiny arms", "bicep definition", 'slender arms', 'delicate arms', 'graceful arms', 'athletic arms', 'feminine arms', 'slim forearms', 'toned forearms', 'sculpted forearms', 'delicate forearms', 'supple forearms', 'long arms', 'short arms', 'compact arms', 'highlighted arms', 'shadowed arms', 'Forearm Musculature', 'Wrist Structure', 'Elbow Definition'] }]},
                { name: "Hands", groups: [{ group: "Hand Detail", keywords: ["delicate hands", "large hands", "veiny hands", "manicured nails", "knuckles", "holding object", 'proportionate hands', 'hairy hands', 'smooth hands', 'oily hands', 'calloused hands', 'hands with visible folds', 'strong grip hands', 'large hands', 'small hands', 'long fingers'] }]},
                { name: "Chest", groups: [{ group: "General Chest", keywords: ["toned chest", "deep cleavage (female)", "flat chest (male)", "defined pecs (male)", 'Collarbone/Clavicle Prominence', 'Deltoid Definition'] }]},
                { name: "Back", groups: [{ group: "Back Detail", keywords: ["toned back", "muscular back", "defined lats", "shoulder blades", "spinal groove", 'slim back', 'soft back', 'supple back', 'delicate back', 'narrow back', 'broad back', 'proportionate back', 'upper back defined', 'mid-back sculpted', 'lower back toned', 'lower back with dimples', 'highlighted spine line', 'subtle spine line', 'arched back', 'dramatic arch', 'elegant arch'] }]}
            ]
        },
        // 6. Lower Body (Order 6.0)
        { 
            category: "Lower Body", 
            description: "Features common to both sexes, focusing on the lower half.", 
            order: 6.0, 
            subcategories: [
                { name: "Glutes", groups: [{ group: "Glute Shape", keywords: ["round glutes", "large glutes", "small glutes", "toned buttocks", "curvy lower body", 'flat buttocks', 'minimal projection', 'narrow rear', 'tight glutes', 'average projection glutes', 'rounded shape glutes', 'proportional glutes', 'ample buttocks', 'full projection glutes', 'voluminous glutes', 'heavy-set behind'] }]},
                { name: "Thighs", groups: [{ group: "Thigh Shape", keywords: ["thick thighs", "slim thighs", "toned thighs", "muscular quads", 'thunder thighs', 'cellulite texture on thighs', 'lean quads', 'muscular hammies', 'long femoral length', 'athletic legs', 'smooth legs', 'hairy legs', 'curvaceous thighs', 'athletic thighs', 'slender thighs', 'powerful thighs', 'feminine thighs'] }]},
                { name: "Legs", groups: [{ group: "Leg Shape", keywords: ["long legs", "curvy legs", "muscular legs", "slim calves", "defined shins", 'slim legs', 'short legs', 'athletic legs', 'toned legs', 'sculpted legs', 'supple legs', 'delicate legs', 'petite legs', 'proportionate legs', 'smooth legs', 'hairy legs', 'cellulite texture', 'freckled legs', 'scarred legs', 'glowing legs', 'elegant thighs', 'dramatic thighs'] }]},
                { name: "Calves", groups: [{ group: "Calf Definition", keywords: ["defined calves", "muscular calves", "slender lower leg", "toned calves", 'gastrocnemius definition'] }]},
                { name: "Ankles & Feet", groups: [
                    { group: "Feet Detail", keywords: ["small feet", "large feet", "manicured toenails", "barefoot", "detailed soles", 'Foot Arch Types'] },
                    { group: "Ankle Structure", keywords: ["thin ankles", "thick ankles", "defined bone structure"] }
                ]},
                { name: "Hip-to-Waist Transition", groups: [
                    { group: "Transition Zones", keywords: ["smooth hip-to-waist curve", "sharp hip-to-waist taper", "gentle side-slope"] }
                ]}
            ]
        },
        // 7. Skin & Surface (Order 7.0)
        { 
            category: "Skin & Surface", 
            description: "Fine details related to the character's skin and markings.", 
            order: 7.0, 
            subcategories: [
                { name: "Skin Tone", groups: [{ group: "Tone", keywords: ["porcelain skin", "tanned skin", "dark skin", "fair skin", "ebony skin", "almond skin", 'golden skin', 'olive skin', 'brown skin', 'deep skin'] }]},
                { name: "Undertones", groups: [{ group: "Undertones", keywords: ["warm undertones", "cool undertones", "neutral undertones", "rosy cheeks"] }]},
                { name: "Texture", groups: [{ group: "Texture", keywords: ["smooth skin", "pitted skin", "oily skin", "dry skin", "flawless skin", 'rough skin', 'coarse skin', 'Pore Visibility'] }]},
                { name: "Glow & Finish", groups: [{ group: "Glow/Finish", keywords: ["glowing skin", "matte finish", "dewy skin", "subtle glow", "shimmering skin", 'radiant skin', 'polished skin', 'Oil/Moisture Levels (matte)', 'Oil/Moisture Levels (dewy)', 'Oil/Moisture Levels (glossy)'] }]},
                { name: "Markings & Scars", groups: [{ group: "Markings/Scars", keywords: ["scars", "blemishes", "birthmark", "tattoos", "stretch marks", 'acne scars', 'dimpled skin', 'moles on skin', 'beauty marks', 'Tattoo Descriptors', 'Birthmarks', 'Stretch Marks'] }]},
                { name: "Freckle Maps", groups: [{ group: "Freckles", keywords: ["scattered freckles", "freckles across nose", "heavy freckles", "subtle freckles", 'freckled skin'] }]},
                { name: "Vein Visibility", groups: [{ group: "Veins", keywords: ["subtle vein visibility", "prominent veins", "blue veins", "delicate veins"] }]},
                { name: "Transitional Zones", groups: [
                    { group: "Body Connections", keywords: ["smooth muscle-to-bone transition", "soft tissue overlap", "defined joint appearance", "seamless anatomical blend"] }
                ]}
            ]
        },
        // 8. Clothing Fit & Style (Order 8.0)
        { 
            category: "Clothing Fit & Style", 
            description: "Keywords to control how the clothing drapes and interacts with the body.", 
            order: 8.0, 
            subcategories: [
                { name: "Silhouette Fit", groups: [{ group: "Fit", keywords: ["form-fitting", "skin-tight", "oversized", "baggy clothes", "tailored suit", "flowing robe"] }]},
                { name: "Fabric Flow", groups: [{ group: "Flow/Drape", keywords: ["draped fabric", "wrinkled fabric", "silk smooth", "heavy cotton texture", "translucent cloth"] }]},
                { name: "Fashion Context", groups: [{ group: "Context", keywords: ["haute couture", "streetwear", "casual clothes", "formal wear", "sports attire"] }]},
                { name: "Pose & Movement", groups: [{ group: "Movement", keywords: ["wind-swept clothes", "dynamic folds", "fabric motion", "billowing cape"] }]},
                { name: "Era-Based Fashion", groups: [{ group: "Era/Style", keywords: ["victorian dress", "1950s fashion", "cyberpunk aesthetic", "steampunk gear"] }]},
                { name: "Function-Based Fit", groups: [{ group: "Function", keywords: ["military uniform", "plate armor", "wet clothes", "damaged uniform"] }]},
                { name: "Cinematic Silhouettes", groups: [{ group: "Cinematic", keywords: ["defined silhouette", "shadowed figure", "backlit silhouette"] }]},
                { name: "Texture Layering", groups: [
                    { group: "Material Interaction", keywords: ["smooth texture on rough fabric", "skin to fabric transition", "multiple surface qualities", "texture transition zones"] }
                ]}
            ]
        },
        // 9. Fantasy & Stylized Anatomy (Order 9.0)
        { 
            category: "Fantasy & Stylized Anatomy", 
            description: "Keywords for non-human and stylized physical traits.", 
            order: 9.0, 
            subcategories: [
                { name: "Species Traits", groups: [{ group: "Species", keywords: ["elven ears", "dragon scales", "feathered wings", "furry tail", "cloven hooves"] }]},
                { name: "Hybrid Features", groups: [{ group: "Hybridization", keywords: ["half-elf", "cat ears and tail", "demonic horns", "angel wings"] }]},
                { name: "Stylized Proportions", groups: [{ group: "Stylization", keywords: ["chibi proportions", "exaggerated features", "comic book physique", "anime style eyes"] }]},
                { name: "Magical Modifiers", groups: [{ group: "Magic", keywords: ["glowing runes", "magical aura", "arcane tattoos", "crystal skin"] }]},
                { name: "Elemental Traits", groups: [{ group: "Elemental", keywords: ["fire hair", "ice skin", "stone texture", "water body"] }]}
            ]
        },
        // 10. Emotional & Expressive Layers (Order 10.0)
        { 
            category: "Emotional & Expressive Layers", 
            description: "Tags to influence mood, facial expression, and body language.", 
            order: 10.0, 
            subcategories: [
                { name: "Mood Tags", groups: [{ group: "Mood", keywords: ["melancholy", "joyful", "pensive", "dramatic lighting", "gloomy atmosphere", "intense"] }]},
                { name: "Facial Emotion", groups: [{ group: "Expression", keywords: ["smiling", "frowning", "fierce expression", "subtle smirk", "crying", "staring intently"] }]},
                { name: "Body Language", groups: [{ group: "Body Language", keywords: ["confident posture", "crouching", "relaxed pose", "hands on hips", "crossed arms", "dynamic pose"] }]},
                { name: "Gesture & Hand Positions", groups: [
                    { group: "Hand Poses", keywords: ["open palm", "fist", "pointing", "delicate hold", "finger articulation spread", "finger articulation curled", "finger articulation interlaced"] },
                    { group: "Body Positioning", keywords: ["Wrist Angles", "Arm Positioning Relative to Body"] }
                ]},
                { name: "Dynamic States & Conditions", groups: [
                    { group: "Muscle & Breathing", keywords: ["Muscle Tension (flexed)", "Muscle Tension (relaxed)", "Muscle Tension (engaged)", "Breathing States (inhaled)", "Breathing States (exhaled)", "Breathing States (neutral)"] },
                    { group: "Postural Alignment", keywords: ["Weight Distribution (standing)", "Weight Distribution (sitting)", "Weight Distribution (leaning)", "neutral spine", "arched spine", "slouched posture"] }
                ]}
            ]
        },
        // 11. Cultural & Historical Archetypes (Order 11.0)
        { 
            category: "Cultural & Historical Archetypes", 
            description: "Descriptors for clothing and character looks based on time period or region.", 
            order: 11.0, 
            subcategories: [
                { name: "Cultural Body Ideals", groups: [{ group: "Ideals", keywords: ["renaissance figure", "geisha proportions", "nordic warrior", "ancient greek statue"] }]},
                { name: "Historical Silhouettes", groups: [{ group: "Silhouettes", keywords: ["18th century corset", "medieval tunic", "flapper dress", "art deco style"] }]},
                { name: "Regional Traits", groups: [{ group: "Regional", keywords: ["east asian features", "mediterranean features", "celtic features", "african features"] }]}
            ]
        },
        // 12. Age & Hormonal Modifiers (Order 12.0)
        { 
            category: "Age & Hormonal Modifiers", 
            description: "Keywords to influence the appearance of age and maturity.", 
            order: 12.0, 
            subcategories: [
                { name: "Youthful Traits", groups: [{ group: "Youthful", keywords: ["smooth skin", "full cheeks", "innocent expression", "childlike"] }]},
                { name: "Mature Traits", groups: [{ group: "Mature", keywords: ["mid-aged", "defined features", "subtle wrinkles", "experienced look"] }]},
                { name: "Aged Features", groups: [{ group: "Aged", keywords: ["deep wrinkles", "grey hair", "crows feet", "weathered skin", "elderly"] }]},
                { name: "Hormonal Influence", groups: [{ group: "Hormonal", keywords: ["masculine features", "androgynous", "soft feminine features", "broad shoulders (female)"] }]}
            ]
        },
        // 13. Scene & Environment Context (Order 13.0)
        { 
            category: "Scene & Environment Context", 
            description: "Tags for placing the character in a setting and controlling scene elements.", 
            order: 13.0, 
            subcategories: [
                { name: "Location Tags", groups: [{ group: "Location", keywords: ["forest setting", "cyberpunk city", "ancient temple", "bar interior", "desert landscape"] }]},
                { name: "Lighting Styles", groups: [{ group: "Lighting", keywords: ["rim lighting", "volumetric lighting", "soft studio lighting", "dramatic shadows", "neon glow"] }]},
                { name: "Camera Angles", groups: [{ group: "Camera", keywords: ["full body shot", "close up", "dynamic pose", "low angle", "dutch angle", "side view"] }]},
                { name: "Background Elements", groups: [{ group: "Background", keywords: ["minimalist background", "detailed background", "blurred background", "bokeh effect"] }]},
                { name: "Lighting Interaction Calculator (Concept)", groups: [
                    { group: "Shadow/Highlight Guidance", keywords: ["light source position: high", "light source position: low", "shadow placement guides", "highlight zones by pose"] }
                ]},
                { name: "Movement & Physics Simulator (Concept)", groups: [
                    { group: "Physics Control", keywords: ["Hair physics in motion", "Fabric drape and flow", "Muscle engagement during action", "Gravitational effects on soft tissue"] }
                ]}
            ]
        },
        // 14. Technical Rendering Tags (Order 14.0)
        { 
            category: "Technical Rendering Tags", 
            description: "Keywords for achieving high-quality, specific artistic outputs.", 
            order: 14.0, 
            subcategories: [
                { name: "Rendering Engines", groups: [{ group: "Engines", keywords: ["unreal engine", "octane render", "blender render", "raytracing"] }]},
                { name: "Aspect Ratios", groups: [{ group: "Ratio", keywords: ["16:9 aspect ratio", "3:2 aspect ratio", "square ratio"] }]},
                { name: "Style Filters", groups: [{ group: "Style", keywords: ["photorealistic", "digital painting", "line art", "cel shaded", "oil painting"] }]},
                { name: "Output Formats", groups: [{ group: "Quality", keywords: ["4k", "8k", "highly detailed", "masterpiece", "trending on artstation", "sharp focus"] }]}
            ]
        },
        // 15. Prompt Formatting & Emphasis (Order 15.0)
        { 
            category: "Prompt Formatting & Emphasis", 
            description: "Tips for using the advanced features and prompt syntax effectively.", 
            order: 15.0, 
            subcategories: [
                { name: "Ratio Syntax", groups: [{ group: "Syntax", keywords: ["(keyword:ratio)", "use ratio panel", "numerical weighting"] }]},
                { name: "Emphasis Weighting", groups: [{ group: "Emphasis", keywords: ["double parentheses", "triple parentheses", "negative prompt tag", "square brackets"] }]},
                { name: "Safe Prompting Tips", groups: [{ group: "Safety", keywords: ["use synonym translator", "focus on body positive terms", "avoid explicit terms"] }]},
                { name: "AI Readability", groups: [{ group: "Readability", keywords: ["concise prompt", "keyword clustering", "ordered flow (head-to-toe)"] }]}
            ]
        },
        // 20. Proportional Relationships & Mathematical Ratios
        {
            category: "Proportional Relationships & Ratios",
            description: "Controlling the mathematical and aesthetic scaling of the character's features.",
            order: 20.0,
            subcategories: [
                { name: "Golden Ratio Applications", groups: [{ group: "Ratio Controls", keywords: ["golden ratio (face)", "golden ratio (body segments)", "facial thirds defined", "body segment proportionality"] }] },
                { name: "Anatomical Measurement Systems", groups: [{ group: "Scale Systems", keywords: ["head-to-body ratio: 1:8", "limb proportionality", "classic human proportions"] }] },
                { name: "Symmetry vs. Asymmetry Controls", groups: [{ group: "Symmetry Modifiers", keywords: ["perfect symmetry", "subtle asymmetry (face)", "dramatic asymmetry (body)", "scale relationships defined"] }] },
                { name: "Comparative Scaling System (Concept)", groups: [{ group: "Scale Reference", keywords: ["relative size comparisons", "percentage-based sizing (50% larger)", "reference object scaling", "shoulder-to-hip ratio: 1.3:1"] }] }
            ]
        },
        // 21. Tutorial Mode / Guided Experience
        {
            category: "Tutorial Mode / Guided Experience",
            description: "Interactive tools and guides for learning to build powerful prompts.",
            order: 21.0,
            subcategories: [
                { name: "Guidance & Progress", groups: [
                    { group: "Learning Tools", keywords: ["Step-by-step wizard", "Interactive tooltips enabled", "Try this example buttons"] },
                    { group: "Progress & Mastery", keywords: ["Progress tracker (Beginner)", "Progress tracker (Intermediate)", "Progress tracker (Advanced)", "Achievement badges unlocked", "Master a category progress"] }
                ]}
            ]
        },
        // 22. Prompt Analyzer & Optimizer
        {
            category: "Prompt Analyzer & Optimizer",
            description: "Tools for reviewing and perfecting existing prompts.",
            order: 22.0,
            subcategories: [
                { name: "Analysis Tools", groups: [
                    { group: "Conflict Detection", keywords: ["Paste prompt for breakdown", "Conflict detector (finds contradictions)", "Redundancy remover"] },
                    { group: "Optimization Metrics", keywords: ["Complexity scorer", "Suggestions for improvement", "A/B testing tracker", "Version History & Iterations"] }
                ]}
            ]
        }
    ];

    // --- Utility Data (Kept Separate for Panels) ---

    const presetsData = [
        { name: "Runway Model", keywords: ["ectomorph", "long legs", "slender waist", "sharp jawline", "haute couture", "photorealistic", "soft studio lighting"] },
        { name: "Fantasy Warrior", keywords: ["mesomorph", "muscular arms", "broad shoulders", "plate armor", "dramatic shadows", "dynamic pose", "scars"] },
        { name: "Vintage Muse", keywords: ["hourglass figure", "full lips", "soft feminine features", "1950s fashion", "rosy cheeks", "wavy hair", "soft studio lighting"] },
        { name: "Sci-Fi Android", keywords: ["defined abs", "metallic skin", "androgynous", "cyberpunk aesthetic", "neon glow", "sharp focus", "blue eyes"] },
        { name: "Athletic Influencer", keywords: ["mesomorph", "toned legs", "six pack", "athletic build", "smooth skin", "gym wear", "high contrast"] },
        { name: "Custom Archetypes", keywords: ["add your own keywords here", "start with 3-5 keywords", "always use body type first"] },
    ];

    const explicitTermSynonyms = {
        "sex": ["sensual", "intimate", "passionate", "affectionate"],
        "breast": ["bust", "cleavage", "chest", "top half"],
        "nude": ["bare", "exposed", "topless", "revealing outfit"],
        "butt": ["glutes", "behind", "hips", "curvy lower body"],
        "vagina": ["female form", "pelvis area", "lower body"],
        "penis": ["male anatomy", "waist area", "midsection"],
        "genitalia": ["private areas", "pelvis area", "lower body"],
        "cunt": ["female form", "waist area", "lower body"],
        "pussy": ["female form", "pelvis area", "lower body"],
        "dick": ["male anatomy", "waist area", "midsection"],
        "cock": ["male anatomy", "waist area", "midsection"],
        "boob": ["bust", "cleavage", "chest", "top half"],
        "fat": ["thick", "full-figured", "robust", "rounded", "ample", "plump"], 
        "big": ["ample", "voluminous", "substantial", "broad", "generous"], 
        "small": ["petite", "slight", "compact", "delicate"], 
        "skinny": ["slender", "slim", "lean", "fine-boned"], 
        "bald": ["shaved head", "clean scalp", "close crop"], 
        "ugly": ["distinctive", "characterful", "unique"], 
        "old": ["mature", "experienced", "seasoned", "aged"], 
        "young": ["youthful", "fresh-faced", "adolescent"], 
        "gross": ["rugged", "textured", "weathered"], 
        "short": ["compact", "petite", "short-statured"], 
        "tall": ["long-limbed", "elongated", "high-statured"], 
        "chubby": ["soft", "rounded", "plump"], 
        "thin": ["slim", "svelte", "lean"], 
        "average": ["proportional", "balanced", "natural build"]
    };

    const ratioKeywordsData = {
        "Glutes": "glutes", "Thighs": "thighs", "Hips": "hips", "Waist": "waist", 
        "Breasts": "bust", "Shoulders": "shoulders", "Arms": "arms", "Legs": "legs", 
        "Feet": "feet", "Eyes": "eyes", "Nose": "nose", "Lips": "lips", 
        "Ears": "ears", "Nostrils": "nostrils", "Jawline": "jawline", "Chin": "chin", 
        "Neck": "neck"
    };
    
    // Initial ratio state (Ratio Scaling Panel)
    const ratioParts = {};
    Object.values(ratioKeywordsData).forEach(part => ratioParts[part] = 1.0);


    const smartTooltips = {
        "ectomorph": "Hint: Focus on slender, long, and elegant poses to accentuate the silhouette.",
        "mesomorph": "Hint: Use action poses and words like 'muscular' or 'toned' for best results.",
        "endomorph": "Hint: Use words like 'curvy' or 'voluptuous' to guide the AI and ensure correct rendering.",
        "volumetric lighting": "Aesthetic Cue: This creates dramatic shafts of light, enhancing cinematic feel.",
        "sharp jawline": "Prompt Tip: Add 'chiseled' or 'defined' for maximum impact.",
        "large bust": "Prompt Tip: Consider adding 'natural lift' for a more realistic result.",
        "low angle": "Aesthetic Cue: Use to emphasize height, power, and dominance.",
        "full body shot": "Prompt Tip: Ensures the AI renders the character head-to-toe and applies all body descriptors.",
    };

    // --- Core Logic ---

    const glossaryContainer = document.getElementById('glossary-container');
    const keywordSearch = document.getElementById('keyword-search');
    const promptOutput = document.getElementById('prompt-output');
    const copyButton = document.getElementById('copy-button');
    const clearButton = document.getElementById('clear-button');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const somatotypeButtons = document.querySelectorAll('.body-type-button');
    const indexList = document.getElementById('floating-index');
    const presetsPanel = document.getElementById('presets-panel');
    const ratioPanel = document.getElementById('ratio-panel');
    const charCounter = document.getElementById('char-counter');
    const tokenEstimator = document.getElementById('token-estimator');

    let selectedKeywords = new Set();
    let selectedSomatotype = '';

    // Create a flat map for easy keyword lookup and ordering reference
    const keywordOrderMap = new Map();
    // Pre-sort the glossaryData array based on the 'order' property before mapping
    glossaryData.sort((a, b) => a.order - b.order).forEach(category => {
        category.subcategories.forEach(sub => {
            const groups = sub.groups || [{ keywords: sub.keywords }];
            
            groups.forEach(group => { 
                group.keywords.forEach(keyword => {
                    // Key is the keyword, value is the category order number
                    keywordOrderMap.set(keyword, category.order);
                });
            });
        });
    });

    // --- Feature Implementations ---

    // Feature: Smart Prompt Formatter with Ratio Integration (Updated for Character/Token Count)
    function formatPrompt() {
        const keywordsArray = Array.from(selectedKeywords);
        
        // 1. Sort keywords by the predefined category order
        const sortedKeywords = keywordsArray.sort((a, b) => {
            const orderA = keywordOrderMap.get(a) || Infinity;
            const orderB = keywordOrderMap.get(b) || Infinity;
            if (orderA !== orderB) {
                return orderA - orderB;
            }
            return a.localeCompare(b);
        });

        // 2. Apply Ratios and Emphasis Syntax
        const finalParts = [];
        const ratioKeywords = Object.keys(ratioKeywordsData).map(key => ratioKeywordsData[key]);

        // Prepend the selected somatotype
        if (selectedSomatotype) {
            finalParts.push(selectedSomatotype);
        }

        sortedKeywords.forEach(keyword => {
            let term = keyword;
            let ratioValue = 1.0;

            // Simple check for Ratio Application (Matching keyword to ratioPart key)
            const baseKeyword = keyword.toLowerCase().replace(/\s/g, '');
            const match = ratioKeywords.find(key => baseKeyword.includes(key));
            
            if (match && ratioParts[match] !== 1.0) {
                ratioValue = ratioParts[match];
                term = `(${keyword}:${ratioValue.toFixed(1)})`;
            } else if (keywordOrderMap.get(keyword) >= 14.0) {
                // Apply optional square brackets for Technical/Aesthetic keywords
                term = `[${keyword}]`;
            }

            // Exclude somatotype keywords if they are already prepended
            if (keyword !== selectedSomatotype) {
                finalParts.push(term);
            }
        });

        const finalPrompt = finalParts.join(', ');
        promptOutput.value = finalPrompt;

        // 3. Update Character/Token Counters
        charCounter.textContent = `Characters: ${finalPrompt.length}`;
        // Basic Token Estimation: Roughly 4 characters per token
        tokenEstimator.textContent = `Estimated Tokens: ${Math.ceil(finalPrompt.length / 4)}`;
    }

    // Feature: Ratio Scaling Panel and Logic
    function renderRatioPanel() {
        ratioPanel.innerHTML = '';
        const ratioKeys = Object.keys(ratioKeywordsData);
        const ratioValues = Object.values(ratioKeywordsData);

        ratioKeys.forEach((name, index) => {
            const part = ratioValues[index];
            const ratioBox = document.createElement('div');
            ratioBox.className = 'bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-center border border-gray-300 dark:border-gray-600';
            ratioBox.innerHTML = `
                <h4 class="font-bold text-gray-800 dark:text-gray-100 text-sm mb-1">${name}</h4>
                <div class="text-md font-mono text-blue-600 dark:text-blue-300 mb-2">
                    <span id="${part}Ratio">${ratioParts[part].toFixed(1)}</span>
                </div>
                <div class="flex justify-center space-x-1">
                    <button onclick="adjustRatio('${part}', 0.1)" class="py-1 px-2 bg-blue-500 text-white text-xs rounded-md hover:bg-blue-600 transition-colors">+</button>
                    <button onclick="adjustRatio('${part}', -0.1)" class="py-1 px-2 bg-red-500 text-white text-xs rounded-md hover:bg-red-600 transition-colors">-</button>
                </div>
            `;
            ratioPanel.appendChild(ratioBox);
        });
    }

    function adjustRatio(part, delta) {
        ratioParts[part] = Math.max(0.1, +(ratioParts[part] + delta).toFixed(1));
        document.getElementById(part + 'Ratio').innerText = ratioParts[part].toFixed(1);
        formatPrompt();
    }
    
    window.adjustRatio = adjustRatio;

    // Feature: Body Type Selector Logic
    somatotypeButtons.forEach(button => {
        button.addEventListener('click', () => {
            const keyword = button.dataset.keyword;
            
            somatotypeButtons.forEach(btn => {
                selectedKeywords.delete(btn.dataset.keyword);
                btn.classList.remove('selected', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
                btn.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            });

            selectedSomatotype = keyword;
            selectedKeywords.add(keyword);
            button.classList.add('selected', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
            button.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            
            formatPrompt();
            renderGlossary(keywordSearch.value);
        });
    });

    // Feature: Persona Presets Panel Logic
    function renderPresetsPanel() {
        presetsPanel.innerHTML = '';
        presetsData.forEach(preset => {
            const button = document.createElement('button');
            button.className = 'py-3 px-4 rounded-lg font-semibold bg-green-500 text-white hover:bg-green-600 transition-colors';
            button.textContent = preset.name;
            button.addEventListener('click', () => {
                preset.keywords.forEach(kw => {
                    selectedKeywords.add(kw);
                });
                formatPrompt();
                renderGlossary(keywordSearch.value);
                alert(`Preset "${preset.name}" applied! Keywords added to your prompt.`);
            });
            presetsPanel.appendChild(button);
        });
    }

    // Feature: Dark Mode Toggle
    darkModeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        const isDark = document.documentElement.classList.contains('dark');
        darkModeToggle.textContent = isDark ? 'Toggle Light Mode' : 'Toggle Dark Mode';
    });

    // Feature: Floating Glossary Index (Updated for Smooth Scrolling)
    function renderIndex() {
        const indexLinks = document.createElement('div');
        glossaryData.forEach(category => {
            const categoryId = category.category.replace(/[^a-zA-Z0-9]/g, '-');
            
            const link = document.createElement('a');
            link.href = `#${categoryId}`;
            link.textContent = category.category;
            link.className = 'block py-1 px-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-gray-700 rounded transition-colors truncate cursor-pointer';
            
            // New smooth scroll logic
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetElement = document.getElementById(categoryId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            indexLinks.appendChild(link);
        });
        indexList.appendChild(indexLinks);
    }
    
    // For SVG Mapper to work
    window.smoothScrollTo = function(id) {
        const targetElement = document.getElementById(id);
        if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }


    // Function to create a keyword button (Includes Smart Tooltips Logic)
    function createKeywordButton(keyword) {
        const button = document.createElement('button');
        button.textContent = keyword;
        button.className = `keyword-button p-3 rounded-lg border-2 text-sm font-medium shadow-sm truncate w-full text-center tooltip-container`;
        
        // Feature: Smart Hover Tooltips
        const tooltipText = smartTooltips[keyword] || `Keyword: ${keyword}. Click to add to prompt.`;
        button.innerHTML = `${keyword}<span class="tooltip-text">${tooltipText}</span>`;

        if (selectedKeywords.has(keyword)) {
            button.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-700', 'hover:bg-blue-700');
            button.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200', 'border-gray-300', 'dark:border-gray-600');
        } else {
            button.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200', 'border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-200', 'dark:hover:bg-gray-600');
            button.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-700', 'hover:bg-blue-700');
        }

        button.addEventListener('click', () => {
            if (selectedKeywords.has(keyword)) {
                selectedKeywords.delete(keyword);
            } else {
                selectedKeywords.add(keyword);
            }
            formatPrompt();
            renderGlossary(keywordSearch.value);
        });
        return button;
    }

    // Function to render the entire glossary or search results
    function renderGlossary(filter = '') {
        glossaryContainer.innerHTML = '';
        const filterText = filter.trim().toLowerCase();

        // Feature: Explicit Term Check (Synonym Translator Box)
        const explicitMatch = Object.keys(explicitTermSynonyms).find(term => filterText !== '' && filterText.includes(term.toLowerCase()));
        if (explicitMatch) {
            const safeWords = explicitTermSynonyms[explicitMatch];
            const resultsSection = document.createElement('div');
            resultsSection.className = 'p-6 bg-yellow-100 dark:bg-yellow-900 rounded-xl shadow-md border-2 border-yellow-400 dark:border-yellow-700';
            resultsSection.innerHTML = `
                <h2 class="text-2xl font-bold mb-3 text-yellow-800 dark:text-yellow-200">🚨 Safety Filter: Forbidden Term Detected</h2>
                <p class="text-yellow-700 dark:text-yellow-300 mb-4">The term **'${explicitMatch}'** may violate AI safety filters. Please use one of these approved, safe alternatives:</p>
            `;
            const keywordsList = document.createElement('div');
            keywordsList.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-6 gap-3';
            
            safeWords.forEach(keyword => {
                keywordsList.appendChild(createKeywordButton(keyword));
            });
            resultsSection.appendChild(keywordsList);
            glossaryContainer.appendChild(resultsSection);
            return;
        }

        // Search Results View
        if (filterText !== '') {
            const allKeywords = Array.from(keywordOrderMap.keys());
            const filteredKeywords = allKeywords.filter(kw => kw.toLowerCase().includes(filterText));

            const resultsSection = document.createElement('div');
            resultsSection.className = 'bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md';
            resultsSection.innerHTML = `<h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Search Results for "${filter}" (${filteredKeywords.length})</h2>`;
            
            const keywordsList = document.createElement('div');
            keywordsList.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-6 gap-3';
            filteredKeywords.forEach(keyword => {
                keywordsList.appendChild(createKeywordButton(keyword));
            });
            resultsSection.appendChild(keywordsList);
            glossaryContainer.appendChild(resultsSection);

        } else {
            // Nested Glossary Rendering (Full Glossary View)
            glossaryData.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.id = category.category.replace(/[^a-zA-Z0-9]/g, '-');
                categoryElement.className = 'bg-white dark:bg-gray-800 rounded-xl p-6 shadow-xl category-card border border-gray-200 dark:border-gray-700';
                categoryElement.innerHTML = `
                    <h2 class="text-3xl font-extrabold mb-2 text-blue-600 dark:text-blue-400">${category.category}</h2>
                    <p class="text-gray-600 dark:text-gray-400 mb-6 text-base">${category.description}</p>
                `;

                const subcategoryWrapper = document.createElement('div');
                subcategoryWrapper.className = 'space-y-6';

                category.subcategories.forEach(sub => {
                    const subElement = document.createElement('div');
                    subElement.className = 'p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700';
                    const cleanSubName = sub.name.replace(/^[0-9]\.?[A-Z][0-9]*\.?\s/, '');
                    subElement.innerHTML = `<h3 class="text-xl font-semibold mb-3 text-gray-800 dark:text-gray-200">${cleanSubName}</h3>`;
                    
                    const groupWrapper = document.createElement('div');
                    groupWrapper.className = 'space-y-4';

                    const groupsToRender = sub.groups || [{ group: 'General Descriptors', keywords: sub.keywords }];

                    groupsToRender.forEach(group => {
                        const groupElement = document.createElement('div');
                        groupElement.className = 'p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow-sm';
                        const cleanGroupName = group.group.replace(/^[0-9]\.?[A-Z][0-9]*\.?\s/, '');
                        groupElement.innerHTML = `<h4 class="text-lg font-medium mb-3 text-green-700 dark:text-green-400">${cleanGroupName}</h4>`;

                        const keywordsList = document.createElement('div');
                        keywordsList.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3';
                        
                        group.keywords.forEach(keyword => {
                            keywordsList.appendChild(createKeywordButton(keyword));
                        });
                        
                        groupElement.appendChild(keywordsList);
                        groupWrapper.appendChild(groupElement);
                    });

                    subElement.appendChild(groupWrapper);
                    subcategoryWrapper.appendChild(subElement);
                });

                categoryElement.appendChild(subcategoryWrapper);
                glossaryContainer.appendChild(categoryElement);
            });
        }
    }

    // --- Event Listeners and Initializers ---
    keywordSearch.addEventListener('input', (e) => {
        renderGlossary(e.target.value);
    });

    copyButton.addEventListener('click', () => {
        if (promptOutput.value.length > 0) {
            promptOutput.select();
            document.execCommand('copy');
            copyButton.textContent = 'Copied!';
            setTimeout(() => {
                copyButton.textContent = 'Copy Prompt';
            } , 2000);
        }
    });

    clearButton.addEventListener('click', () => {
        selectedKeywords.clear();
        selectedSomatotype = '';
        somatotypeButtons.forEach(btn => {
            btn.classList.remove('selected', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
            btn.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
        });
        // Reset Ratios to 1.0
        Object.keys(ratioParts).forEach(key => ratioParts[key] = 1.0);
        renderRatioPanel();
        
        formatPrompt();
        renderGlossary(keywordSearch.value);
    });

    // Initial renders on page load
    document.addEventListener('DOMContentLoaded', () => {
        renderRatioPanel();
        renderPresetsPanel();
        renderGlossary();
        renderIndex();
    });
</script>

</body>
</html>
